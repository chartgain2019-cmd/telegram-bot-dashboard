<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุจูุช ุชูุฌุฑุงู - ุฎุฏูุฉ ุฃูููุงุก ุงูุฃููุฑ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- JotForm Chat Bot Script -->
    <script src='https://cdn.jotfor.ms/agent/embedjs/019932f8eeb67de397162a0d8c2d541451fe/embed.js'></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .message-bubble {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .file-item {
            transition: all 0.3s ease;
        }
        .file-item:hover {
            transform: translateX(-5px);
        }
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        .typing-dots span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .service-card {
            transition: all 0.3s ease;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .service-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chat-container {
            height: calc(100vh - 80px);
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.1);
        }
        @media (max-width: 640px) {
            .chat-container {
                height: calc(100vh - 60px);
                border-radius: 15px 15px 0 0;
            }
        }
        
        /* JotForm Chat Bot Container */
        #jotform-chat-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <div class="gradient-bg text-white p-4 shadow-lg">
        <div class="flex items-center justify-between max-w-md mx-auto">
            <div class="flex items-center space-x-3 space-x-reverse">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow">
                    <span class="text-blue-600 text-xl">๐ค</span>
                </div>
                <div>
                    <h1 class="font-bold text-lg">ุจูุช ุฎุฏูุฉ ุฃูููุงุก ุงูุฃููุฑ</h1>
                    <p class="text-blue-100 text-sm" id="connectionStatus">ุฌุงุฑู ุงูุชุญููู...</p>
                </div>
            </div>
            <div class="text-blue-100 bg-white/20 p-2 rounded-full">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="max-w-md mx-auto bg-white chat-container flex flex-col">
        <!-- Navigation Header -->
        <div id="navigationHeader" class="bg-gradient-to-r from-blue-50 to-purple-50 p-3 border-b flex items-center justify-between hidden shadow-sm">
            <div class="flex space-x-2 space-x-reverse">
                <button id="backToServices" onclick="showMainServices()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-medium transition-colors shadow hidden">
                    โ ุงูุฎุฏูุงุช
                </button>
                <button id="backToSections" onclick="showServiceSections(currentService)" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded-lg text-xs font-medium transition-colors shadow hidden">
                    โ ุงูุฃูุณุงู
                </button>
            </div>
            <span id="currentLevel" class="text-gray-700 font-medium text-xs bg-white/80 px-2 py-1 rounded-full"></span>
        </div>

        <!-- Messages Area -->
        <div id="messagesArea" class="flex-1 p-3 space-y-3 overflow-y-auto bg-gray-50">
            <!-- Welcome Message -->
            <div class="message-bubble">
                <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 max-w-xs border border-blue-200">
                    <div class="flex items-center space-x-2 space-x-reverse mb-1">
                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xs">๐ค</span>
                        </div>
                        <span class="text-blue-700 text-xs font-bold">ูุณุงุนุฏ ุงููุฏุฑุณุฉ</span>
                    </div>
                    <p class="text-gray-800 text-sm font-medium">ูุฑุญุจุงู ุจู ูู ุจูุช ุฎุฏูุฉ ุฃูููุงุก ุงูุฃููุฑ! ๐</p>
                    <p class="text-gray-600 text-xs mt-1">ุงุฎุชุฑ ุงูุฎุฏูุฉ ุงููุทููุจุฉ ูู ุงูุฃุณูู ุฃู ุงูุชุจ ุณุคุงูู.</p>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="flex justify-center p-3 bg-gray-50">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg p-3 shadow w-full max-w-xs">
                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                    <div class="typing-dots">
                        <span class="bg-white"></span>
                        <span class="bg-white"></span>
                        <span class="bg-white"></span>
                    </div>
                    <p class="font-medium text-sm">๐ ุฌุงุฑู ุชุญููู ุงูุฎุฏูุงุช...</p>
                </div>
            </div>
        </div>

        <!-- Services Container -->
        <div id="servicesContainer" class="p-3 bg-gray-50 hidden">
            <!-- Services will be added here dynamically -->
        </div>

        <!-- Sections Container -->
        <div id="sectionsContainer" class="p-3 bg-gray-50 hidden">
            <!-- Sections will be added here dynamically -->
        </div>

        <!-- Content Container -->
        <div id="contentContainer" class="p-3 bg-gray-50 hidden">
            <!-- Content will be added here dynamically -->
        </div>

        <!-- Input Area -->
        <div class="border-t bg-white p-3 shadow-inner">
            <div class="flex items-center space-x-2 space-x-reverse">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."
                    class="flex-1 border border-gray-300 rounded-full px-3 py-2 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all"
                >
                <button 
                    onclick="sendMessage()" 
                    class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-full p-2 transition-all shadow"
                >
                    <svg class="w-4 h-4 transform rotate-180" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- JotForm Chat Container -->
    <div id="jotform-chat-container"></div>

    <script>
        // ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
        let currentStudent = null;
        let botData = null;
        let currentService = null;
        let currentSection = null;
        let isAIActive = false;
        
        // ุฅุนุฏุงุฏุงุช API
        const API_URL = '/api/data';
        const GEMINI_API_KEY = 'AIzaSyAVpqpWWrcvzXrheTIhAKRDSRYonuN0weU';
        
        // ุชููุฆุฉ ุชุทุจูู Telegram
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        // ุงูุชุญูู ูู ุตุญุฉ ููุชุงุญ API
        async function validateAPIKey() {
            try {
                updateStatus('๐ ุฌุงุฑู ุงูุชุญูู ูู ุงูุงุชุตุงู...');
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "test" }] }]
                    })
                });
                
                if (response.status === 200 || response.status === 400) {
                    console.log('โ API Key is valid and active');
                    isAIActive = true;
                    updateStatus('โ ูุชุตู - ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุดุท');
                    return true;
                } else {
                    throw new Error(`Status: ${response.status}`);
                }
            } catch (error) {
                console.warn('โ Cannot reach Gemini API, using smart responses');
                isAIActive = false;
                updateStatus('โ๏ธ ูุชุตู - ุงุณุชุฎุฏุงู ุงูุฑุฏูุฏ ุงูุฐููุฉ');
                return false;
            }
        }

        // ุงูุญุตูู ุนูู ุฑุฏ ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
        async function getAIResponse(userMessage) {
            if (!isAIActive) {
                return getSmartResponse(userMessage);
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `ุฃูุช ูุณุงุนุฏ ุจูุช ูุฏุฑุณู ุฐูู ูุฃูููุงุก ุงูุฃููุฑ. 

                                ูุนูููุงุช ุงููุฏุฑุณุฉ:
                                - ุงููุฏุฑุณุฉ: ูุฏุฑุณุฉ ุงููููุฐุฌ ุงูุงุจุชุฏุงุฆูุฉ
                                - ุงูุฎุฏูุงุช: ุฌุฏูู ุฏุฑุงุณูุ ูุงุฌุจุงุชุ ุงุฎุชุจุงุฑุงุชุ ูููุงุชุ ุจุฑุงูุฌ
                                - ุงููุณุชุฎุฏู: ููู ุฃูุฑ ุทุงูุจ

                                ูููุชู:
                                - ุงูุฑุฏ ุนูู ุงุณุชูุณุงุฑุงุช ุฃูููุงุก ุงูุฃููุฑ
                                - ุชูุฏูู ูุนูููุงุช ุนู ุงูุฎุฏูุงุช ุงููุฏุฑุณูุฉ
                                - ุชูุฌูู ุงููุณุชุฎุฏู ูููุณู ุงูููุงุณุจ
                                - ุงูุฑุฏ ุจุทุฑููุฉ ูุฏูุฏุฉ ููููุฏุฉ

                                ุงุณุชูุณุงุฑ ููู ุงูุฃูุฑ: "${userMessage}"

                                ุงูุฑุฏ ุงูููุงุณุจ:`
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 800,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    return getSmartResponse(userMessage);
                }
                
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                return getSmartResponse(userMessage);
            }
        }

        // ูุธุงู ุงูุฑุฏูุฏ ุงูุฐููุฉ
        function getSmartResponse(userMessage) {
            const msg = userMessage.toLowerCase().trim();
            
            const responseMap = {
                'ุฌุฏูู': '๐ **ุงูุฌุฏูู ุงูุฏุฑุงุณู**\n\nููููู ุงูุงุทูุงุน ุนูู ุงูุฌุฏุงูู ุงูุฏุฑุงุณูุฉ ูุฌููุน ุงูุตููู ูู ูุณู "ุงูุฌุฏูู ุงูุฏุฑุงุณู".\n\nโข ุงุฎุชุฑ ุงูุตู ุงููุทููุจ\nโข ุงูุฌุฏุงูู ูุญุฏุซุฉ ุฃุณุจูุนูุงู\nโข ุชุดูู ุฌููุน ุงูููุงุฏ ูุงูุฃูุดุทุฉ',
                
                'ูุงุฌุจ': '๐ **ุงููุงุฌุจุงุช ุงูููุฒููุฉ**\n\nุงููุงุฌุจุงุช ูุชุงุญุฉ ูู ูุณู "ุงููุงุฌุจุงุช ุงูููุฒููุฉ" ููุณูุฉ ุญุณุจ:\n\nโข ุงูุตููู ุงูุฏุฑุงุณูุฉ\nโข ุงูููุงุฏ ุงูุชุนููููุฉ\nโข ููุงุนูุฏ ุงูุชุณููู\n\nุณุชุฌุฏ ุชูุงุตูู ูู ูุงุฌุจ ูููุนุฏ ุชุณูููู.',
                
                'ุงุฎุชุจุงุฑ': '๐ **ุงูุงุฎุชุจุงุฑุงุช**\n\nูุนูููุงุช ุงูุงุฎุชุจุงุฑุงุช ูู ูุณู "ุงูุงุฎุชุจุงุฑุงุช":\n\nโข ููุงุนูุฏ ุงูุงุฎุชุจุงุฑุงุช\nโข ุงูููุงุฏ ุงูููุฑุฑุฉ\nโข ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช\nโข ููุงุฐุฌ ุงูุงุฎุชุจุงุฑุงุช',
                
                'ููู': '๐ **ุงููููุงุช ุงููุฑุณูุฉ**\n\nุฌููุน ุงููููุงุช ูุชุงุญุฉ ููุชุญููู ูู ูุณู "ุงููููุงุช ุงููุฑุณูุฉ":\n\nโข ุงูุฌุฏุงูู ุงูุฒูููุฉ\nโข ููุงุฐุฌ ุงูุทูุจุงุช\nโข ุฏููู ููู ุงูุฃูุฑ\nโข ุงููุชุจ ุงููุฏุฑุณูุฉ',
                
                'ุจุฑูุงูุฌ': '๐ **ุงูุจุฑุงูุฌ ูุงููุณุงุจูุงุช**\n\nุงูุจุฑุงูุฌ ุงูุญุงููุฉ ูู ูุณู "ุงูุจุฑุงูุฌ ูุงููุณุงุจูุงุช":\n\nโข ูุณุงุจูุงุช ูุฑุขููุฉ\nโข ุจุฑุงูุฌ ุงูููุงูุจ\nโข ุฃูุดุทุฉ ุฑูุงุถูุฉ\nโข ูุนุงุฑุถ ุนูููุฉ',
                
                'ุฅุฌุงุฒุฉ': '๐ข **ุงูุฅุนูุงูุงุช ูุงูุฅุฌุงุฒุงุช**\n\nุขุฎุฑ ุงูุฅุนูุงูุงุช ูู ูุณู "ุงูุจุฑููุงุณุช":\n\nโข ููุงุนูุฏ ุงูุฅุฌุงุฒุงุช\nโข ุงุฌุชูุงุนุงุช ุฃูููุงุก ุงูุฃููุฑ\nโข ูุนุงููุงุช ุงููุฏุฑุณุฉ\nโข ุชูุจููุงุช ูููุฉ',
                
                'ุดูุฑ': '๐น **ุดูุฑุงู ูู!**\n\nุณุนูุฏ ูุฃููู ุงุณุชุทุนุช ูุณุงุนุฏุชู. ุฅุฐุง ูุงู ูุฏูู ุฃู ุงุณุชูุณุงุฑ ุขุฎุฑุ ุฃูุง ููุง ููุณุงุนุฏุชู ุฏุงุฆูุงู.',
                
                'default': `๐ **ูุฑุญุจุงู ุจู!**\n\nุณุคุงูู: "${userMessage}"\n\nูููููู ูุณุงุนุฏุชู ูู:\n\nโข ๐ **ุงูุฌุฏูู ุงูุฏุฑุงุณู** - ุฌุฏุงูู ุฌููุน ุงูุตููู\nโข ๐ **ุงููุงุฌุจุงุช** - ุงููุงุฌุจุงุช ุงูููุฒููุฉ ูููุงุนูุฏูุง\nโข ๐ข **ุงูุจุฑููุงุณุช** - ุขุฎุฑ ุงูุฅุนูุงูุงุช\nโข ๐ **ุงูุจุฑุงูุฌ** - ุงููุณุงุจูุงุช ูุงูุฃูุดุทุฉ\nโข ๐ **ุงููููุงุช** - ุฌููุน ุงููููุงุช ููุชุญููู\nโข ๐ **ุงูุงุฎุชุจุงุฑุงุช** - ููุงุนูุฏ ููุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช\nโข ๐ค **ุงููุณุงุนุฏ ุงูุฐูู** - ููุฅุฌุงุจุฉ ุนูู ุฃุณุฆูุชู\n\nุงุฎุชุฑ ุงูุฎุฏูุฉ ุงูููุงุณุจุฉ ูู ุงููุงุฆูุฉ!`
            };

            for (const [keyword, response] of Object.entries(responseMap)) {
                if (msg.includes(keyword) && keyword !== 'default') {
                    return response;
                }
            }
            
            return responseMap.default;
        }

        // ุชุญููู ุงูุจูุงูุงุช
        async function loadData() {
            showLoading(true);
            
            try {
                await validateAPIKey();
                
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error('ูุดู ูู ุฌูุจ ุงูุจูุงูุงุช');
                }
                
                botData = await response.json();
                showLoading(false);
                showMainServices();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showLoading(false);
                useDefaultData();
            }
        }

        // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ
        function useDefaultData() {
            botData = {
                services: {
                    'schedule': { 
                        name: 'ุงูุฌุฏูู ุงูุฏุฑุงุณู', 
                        icon: '๐',
                        sections: [
                            { name: 'ุงูุตู ุงูุฃูู', description: 'ุงูุฌุฏูู ุงูุฃุณุจูุนู ููุตู ุงูุฃูู', content: [
                                { type: 'text', content: '๐ **ุงูุฌุฏูู ุงูุฏุฑุงุณู ููุตู ุงูุฃูู**\n\n**ุงูุฃุญุฏ:**\nโข ุฑูุงุถูุงุช (8:00 - 9:00)\nโข ุนุฑุจู (9:00 - 10:00)\nโข ุนููู (10:30 - 11:30)\n\n**ุงูุงุซููู:**\nโข ุฅูุฌููุฒู (8:00 - 9:00)\nโข ุชุงุฑูุฎ (9:00 - 10:00)\nโข ุฑูุงุถุฉ (10:30 - 11:30)' }
                            ]},
                            { name: 'ุงูุตู ุงูุซุงูู', description: 'ุงูุฌุฏูู ุงูุฃุณุจูุนู ููุตู ุงูุซุงูู', content: [
                                { type: 'text', content: '๐ **ุงูุฌุฏูู ุงูุฏุฑุงุณู ููุตู ุงูุซุงูู**\n\n**ุงูุฃุญุฏ:**\nโข ุนููู (8:00 - 9:00)\nโข ุนุฑุจู (9:00 - 10:00)\nโข ุฑูุงุถูุงุช (10:30 - 11:30)\n\n**ุงูุงุซููู:**\nโข ุฅูุฌููุฒู (8:00 - 9:00)\nโข ุชุฑุจูุฉ ุฅุณูุงููุฉ (9:00 - 10:00)\nโข ุฑูุงุถุฉ (10:30 - 11:30)' }
                            ]},
                            { name: 'ุงูุตู ุงูุซุงูุซ', description: 'ุงูุฌุฏูู ุงูุฃุณุจูุนู ููุตู ุงูุซุงูุซ', content: [
                                { type: 'text', content: '๐ **ุงูุฌุฏูู ุงูุฏุฑุงุณู ููุตู ุงูุซุงูุซ**\n\n**ุงูุฃุญุฏ:**\nโข ุฅูุฌููุฒู (8:00 - 9:00)\nโข ุฑูุงุถูุงุช (9:00 - 10:00)\nโข ุนููู (10:30 - 11:30)\n\n**ุงูุงุซููู:**\nโข ุนุฑุจู (8:00 - 9:00)\nโข ุชุฑุจูุฉ ุฅุณูุงููุฉ (9:00 - 10:00)\nโข ุฑูุงุถุฉ (10:30 - 11:30)' }
                            ]}
                        ] 
                    },
                    'homework': { 
                        name: 'ุงููุงุฌุจุงุช ุงูููุฒููุฉ', 
                        icon: '๐',
                        sections: [
                            { name: 'ุงูุตู ุงูุฃูู', description: 'ุงููุงุฌุจุงุช ุงููุทููุจุฉ ููุตู ุงูุฃูู', content: [
                                { type: 'text', content: '๐ **ูุงุฌุจุงุช ุงูุตู ุงูุฃูู**\n\n**ุงูุฑูุงุถูุงุช:**\nโข ุญู ุงูุชูุงุฑูู ูู ุตูุญุฉ 45 ุฅูู 47\nโข ุญูุธ ุฌุฏูู ุงูุถุฑุจ ููุนุฏุฏ 2\n\n**ุงููุบุฉ ุงูุนุฑุจูุฉ:**\nโข ูุชุงุจุฉ ููุถูุน ุชุนุจูุฑ ุนู "ุงููุฏุฑุณุฉ"\nโข ูุฑุงุกุฉ ุงููุตุฉ ูู ุตูุญุฉ 23\n\nโฐ **ููุนุฏ ุงูุชุณููู:** ุบุฏุงู' }
                            ]},
                            { name: 'ุงูุตู ุงูุซุงูู', description: 'ุงููุงุฌุจุงุช ุงููุทููุจุฉ ููุตู ุงูุซุงูู', content: [
                                { type: 'text', content: '๐ **ูุงุฌุจุงุช ุงูุตู ุงูุซุงูู**\n\n**ุงูุฑูุงุถูุงุช:**\nโข ุญู ุงููุณุงุฆู ูู ุตูุญุฉ 32 ุฅูู 35\nโข ูุฑุงุฌุนุฉ ุฏุฑุณ ุงููุณูุฑ\n\n**ุงููุบุฉ ุงูุนุฑุจูุฉ:**\nโข ุฅููุงุก ุงูููุฑุฉ ุงูุฃููู ูู ุงูุฏุฑุณ\nโข ูุชุงุจุฉ 10 ุฃุณุทุฑ ุนู ุงููุธุงูุฉ\n\nโฐ **ููุนุฏ ุงูุชุณููู:** ุจุนุฏ ุบุฏ' }
                            ]},
                            { name: 'ุงูุตู ุงูุซุงูุซ', description: 'ุงููุงุฌุจุงุช ุงููุทููุจุฉ ููุตู ุงูุซุงูุซ', content: [
                                { type: 'text', content: '๐ **ูุงุฌุจุงุช ุงูุตู ุงูุซุงูุซ**\n\n**ุงูุฑูุงุถูุงุช:**\nโข ุญู ุงูุชูุงุฑูู ูู ุตูุญุฉ 50 ุฅูู 55\nโข ุฅุนุฏุงุฏ ุนุฑุถ ุนู ุงูุฃุดูุงู ุงูููุฏุณูุฉ\n\n**ุงููุบุฉ ุงูุนุฑุจูุฉ:**\nโข ุชุญููู ุงููุต ุงูุฃุฏุจู ูู ุตูุญุฉ 67\nโข ูุชุงุจุฉ ูุตุฉ ูุตูุฑุฉ\n\nโฐ **ููุนุฏ ุงูุชุณููู:** ุงูุฃุณุจูุน ุงููุงุฏู' }
                            ]}
                        ] 
                    },
                    'ai': { 
                        name: 'ุงููุณุงุนุฏ ุงูุฐูู', 
                        icon: '๐ค',
                        sections: [] 
                    },
                    'broadcast': { 
                        name: 'ุงูุจุฑููุงุณุช', 
                        icon: '๐ข',
                        sections: [] 
                    },
                    'programs': { 
                        name: 'ุงูุจุฑุงูุฌ ูุงููุณุงุจูุงุช', 
                        icon: '๐',
                        sections: [] 
                    },
                    'files': { 
                        name: 'ุงููููุงุช ุงููุฑุณูุฉ', 
                        icon: '๐',
                        sections: [
                            { 
                                name: 'ูููุงุช ุงูุตู ุงูุฃูู', 
                                description: 'ุฌููุน ุงููููุงุช ุงููุฑุณูุฉ ููุตู ุงูุฃูู',
                                content: [
                                    { type: 'pdf', title: 'ุฌุฏูู ุงูุงุฎุชุจุงุฑุงุช', fileUrl: '/files/exam-schedule.pdf' },
                                    { type: 'pdf', title: 'ูุงุฆูุฉ ุงููุชุจ', fileUrl: '/files/books-list.pdf' }
                                ]
                            },
                            { 
                                name: 'ูููุงุช ุงูุตู ุงูุซุงูู', 
                                description: 'ุฌููุน ุงููููุงุช ุงููุฑุณูุฉ ููุตู ุงูุซุงูู',
                                content: [
                                    { type: 'pdf', title: 'ุฏููู ููู ุงูุฃูุฑ', fileUrl: '/files/parent-guide.pdf' },
                                    { type: 'pdf', title: 'ุงูุชูููู ุงูุฏุฑุงุณู', fileUrl: '/files/calendar-2024.pdf' }
                                ]
                            }
                        ] 
                    },
                    'exams': { 
                        name: 'ุงูุงุฎุชุจุงุฑุงุช', 
                        icon: '๐',
                        sections: [] 
                    },
                    'contact': { 
                        name: 'ุชูุงุตู ูุนูุง', 
                        icon: '๐',
                        sections: [] 
                    }
                }
            };
            showMainServices();
        }

        // ุนุฑุถ ุงูุฎุฏูุงุช ุงูุฑุฆูุณูุฉ
        function showMainServices() {
            hideAllContainers();
            document.getElementById('servicesContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.add('hidden');
            
            const servicesContainer = document.getElementById('servicesContainer');
            servicesContainer.innerHTML = '';

            let servicesHtml = `
                <div class="message-bubble">
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 border border-blue-200">
                        <p class="text-gray-800 font-bold mb-2 text-sm">๐ ุงุฎุชุฑ ุงูุฎุฏูุฉ ุงููุทููุจุฉ:</p>
                        <div class="grid grid-cols-2 gap-2">
            `;

            // ุชุนุฑูู ุงูุฃุฒุฑุงุฑ ูุน ุงูุฃููููุงุช ูุงููุตูุต
            const serviceButtons = [
                { key: 'schedule', name: 'ุงูุฌุฏูู ุงูุฏุฑุงุณู', icon: '๐', color: 'bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600' },
                { key: 'homework', name: 'ุงููุงุฌุจุงุช ุงูููุฒููุฉ', icon: '๐', color: 'bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600' },
                { key: 'ai', name: 'ุงููุณุงุนุฏ ุงูุฐูู', icon: '๐ค', color: 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600' },
                { key: 'broadcast', name: 'ุงูุจุฑููุงุณุช', icon: '๐ข', color: 'bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600' },
                { key: 'programs', name: 'ุงูุจุฑุงูุฌ ูุงููุณุงุจูุงุช', icon: '๐', color: 'bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600' },
                { key: 'files', name: 'ุงููููุงุช ุงููุฑุณูุฉ', icon: '๐', color: 'bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600' },
                { key: 'exams', name: 'ุงูุงุฎุชุจุงุฑุงุช', icon: '๐', color: 'bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600' },
                { key: 'contact', name: 'ุชูุงุตู ูุนูุง', icon: '๐', color: 'bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600' }
            ];

            serviceButtons.forEach(button => {
                servicesHtml += `
                    <button onclick="selectService('${button.key}')" class="${button.color} text-white p-2 rounded-lg text-xs font-medium transition-all service-card flex flex-col items-center justify-center h-14">
                        <span class="text-sm mb-1">${button.icon}</span>
                        <span class="text-xs">${button.name}</span>
                    </button>
                `;
            });

            servicesHtml += `
                        </div>
                    </div>
                </div>
            `;

            servicesContainer.innerHTML = servicesHtml;
        }

        // ุงุฎุชูุงุฑ ุฎุฏูุฉ
        async function selectService(serviceKey) {
            currentService = serviceKey;
            const serviceInfo = botData.services[serviceKey];
            
            showLoading(true);
            
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('ูุดู ูู ุฌูุจ ุงูุจูุงูุงุช');
                
                const data = await response.json();
                const serviceData = data.services[serviceKey];
                
                showLoading(false);
                
                if (serviceData && serviceData.sections && serviceData.sections.length > 0) {
                    showServiceSections(serviceKey);
                } else {
                    showServiceContent(serviceKey, null);
                }
                
            } catch (error) {
                showLoading(false);
                const serviceData = botData.services[serviceKey];
                if (serviceData && serviceData.sections && serviceData.sections.length > 0) {
                    showServiceSections(serviceKey);
                } else {
                    showServiceContent(serviceKey, null);
                }
            }
        }

        // ุนุฑุถ ุฃูุณุงู ุงูุฎุฏูุฉ
        function showServiceSections(serviceKey) {
            hideAllContainers();
            document.getElementById('sectionsContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.remove('hidden');
            document.getElementById('backToServices').classList.remove('hidden');
            document.getElementById('backToSections').classList.add('hidden');
            document.getElementById('currentLevel').textContent = botData.services[serviceKey].name;
            
            const sectionsContainer = document.getElementById('sectionsContainer');
            sectionsContainer.innerHTML = '';

            const service = botData.services[serviceKey];
            
            let sectionsHtml = `
                <div class="message-bubble">
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 border border-blue-200">
                        <p class="text-gray-800 font-bold mb-2 text-sm">๐ ุงุฎุชุฑ ุงููุณู ุงููุทููุจ:</p>
                        <div class="grid grid-cols-2 gap-2">
            `;

            if (service.sections && service.sections.length > 0) {
                service.sections.forEach((section, index) => {
                    sectionsHtml += `
                        <button onclick="selectSection('${serviceKey}', ${index})" class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white p-2 rounded-lg text-xs font-medium transition-all service-card flex flex-col items-center justify-center h-14">
                            <span class="text-sm mb-1">๐</span>
                            <span class="text-xs">${section.name}</span>
                        </button>
                    `;
                });
            } else {
                sectionsHtml += `
                    <div class="col-span-2 bg-yellow-100 border border-yellow-300 text-yellow-800 p-3 rounded-lg text-center">
                        <span class="text-sm">โ๏ธ</span>
                        <p class="mt-1 text-xs">ูุง ุชูุฌุฏ ุฃูุณุงู ูุชุงุญุฉ ููุฐู ุงูุฎุฏูุฉ ุญุงููุงู</p>
                    </div>
                `;
            }

            sectionsHtml += `
                        </div>
                    </div>
                </div>
            `;

            sectionsContainer.innerHTML = sectionsHtml;
        }

        // ุงุฎุชูุงุฑ ูุณู
        function selectSection(serviceKey, sectionIndex) {
            currentService = serviceKey;
            currentSection = sectionIndex;
            showServiceContent(serviceKey, sectionIndex);
        }

        // ุนุฑุถ ูุญุชูู ุงูุฎุฏูุฉ
        function showServiceContent(serviceKey, sectionIndex) {
            hideAllContainers();
            document.getElementById('contentContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.remove('hidden');
            document.getElementById('backToSections').classList.remove('hidden');
            document.getElementById('backToServices').classList.add('hidden');
            
            const service = botData.services[serviceKey];
            let contentHtml = '';
            
            if (sectionIndex !== null) {
                const section = service.sections[sectionIndex];
                document.getElementById('currentLevel').textContent = `${service.name} - ${section.name}`;
                
                contentHtml = `
                    <div class="message-bubble">
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 border border-blue-200">
                            <h3 class="font-bold text-sm mb-1 text-gray-800">${section.name}</h3>
                            ${section.description && section.description !== 'ูุง ููุฌุฏ ูุตู' ? 
                                `<p class="text-gray-600 mb-2 bg-white/50 p-2 rounded text-xs">${section.description}</p>` : ''}
                `;
                
                if (section.content && section.content.length > 0) {
                    section.content.forEach(item => {
                        if (item.type === 'text') {
                            contentHtml += `
                                <div class="bg-white p-3 rounded-lg border border-gray-200 mb-2 shadow-sm">
                                    <p class="text-gray-800 whitespace-pre-line leading-relaxed text-xs">${item.content}</p>
                                </div>
                            `;
                        } else if (item.type === 'pdf') {
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 shadow-sm flex items-center justify-between file-item">
                                    <div class="flex items-center">
                                        <span class="ml-2 text-lg">๐</span>
                                        <div>
                                            <p class="text-gray-800 font-medium text-xs">${item.title}</p>
                                            <p class="text-gray-500 text-xs">ููู PDF</p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-1 space-x-reverse">
                                        <a href="${window.location.origin}${item.fileUrl}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors shadow">
                                            ูุนุงููุฉ
                                        </a>
                                        <a href="${window.location.origin}${item.fileUrl}" download class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs transition-colors shadow">
                                            ุชุญููู
                                        </a>
                                    </div>
                                </div>
                            `;
                        }
                    });
                } else {
                    contentHtml += `
                        <div class="bg-yellow-100 border border-yellow-300 text-yellow-800 p-3 rounded-lg text-center">
                            <span class="text-sm">โ๏ธ</span>
                            <p class="mt-1 text-xs">ูุง ููุฌุฏ ูุญุชูู ูู ูุฐุง ุงููุณู ุญุงููุงู</p>
                        </div>
                    `;
                }
                
                contentHtml += `</div></div>`;
            } else {
                document.getElementById('currentLevel').textContent = service.name;
                const defaultContent = getDefaultServiceContent(serviceKey);
                contentHtml = `
                    <div class="message-bubble">
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 border border-blue-200">
                            <h3 class="font-bold text-sm mb-2 text-gray-800">${service.name}</h3>
                            <div class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                                <p class="text-gray-800 whitespace-pre-line leading-relaxed text-xs">${defaultContent}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentContainer').innerHTML = contentHtml;
        }

        // ุงููุญุชูู ุงูุงูุชุฑุงุถู ููุฎุฏูุงุช
        function getDefaultServiceContent(serviceKey) {
            const defaultContents = {
                'schedule': '๐ **ุงูุฌุฏูู ุงูุฏุฑุงุณู**\n\nููููู ุงูุงุทูุงุน ุนูู ุงูุฌุฏุงูู ุงูุฏุฑุงุณูุฉ ูุฌููุน ุงูุตููู ูู ุงูุฃูุณุงู ุงููุฎุตุตุฉ ููู ุตู.\n\nโข ุงุฎุชุฑ ุงูุตู ุงููุทููุจ ูู ุงููุงุฆูุฉ\nโข ุงูุฌุฏุงูู ูุญุฏุซุฉ ุฃุณุจูุนูุงู\nโข ุชุดูู ุฌููุน ุงูููุงุฏ ูุงูุฃูุดุทุฉ\nโข ููุงุนูุฏ ุงูุญุตุต ูู 8:00 ุตุจุงุญุงู ุฅูู 11:30 ุธูุฑุงู',
                'homework': '๐ **ุงููุงุฌุจุงุช ุงูููุฒููุฉ**\n\nุงููุงุฌุจุงุช ูุชุงุญุฉ ูู ุงูุฃูุณุงู ุงููุฎุตุตุฉ ููู ุตู ุฏุฑุงุณู.\n\nโข ุงุฎุชุฑ ุงูุตู ุงููุทููุจ\nโข ุณุชุฌุฏ ุชูุงุตูู ูู ูุงุฌุจ\nโข ููุงุนูุฏ ุงูุชุณููู ูุญุฏุฏุฉ\nโข ููููู ุงูุชูุงุตู ูุน ุงููุนูู ููุงุณุชูุณุงุฑ',
                'ai': '๐ค **ุงููุณุงุนุฏ ุงูุฐูู**\n\nูุฑุญุจุงู! ุฃูุง ูุณุงุนุฏู ุงูุฐูู ููุฑุฏ ุนูู ุงุณุชูุณุงุฑุงุชู ุงููุฏุฑุณูุฉ.\n\nูููููู ูุณุงุนุฏุชู ูู:\nโข ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุชุนููููุฉ\nโข ุดุฑุญ ุงูููุงููู ุงูุตุนุจุฉ\nโข ูุณุงุนุฏุฉ ูู ุญู ุงููุงุฌุจุงุช\nโข ุชูุฏูู ูุตุงุฆุญ ุฏุฑุงุณูุฉ\nโข ุชูุฌููู ููุฎุฏูุงุช ุงูููุงุณุจุฉ\n\nูุง ุงูุฐู ุชุฑูุฏ ุฃู ุชุณุฃู ุนููุ ุงูุชุจ ุณุคุงูู ูุจุงุดุฑุฉ ูู ูุฑุจุน ุงูุฑุณุงุฆู!',
                'broadcast': '๐ข **ุขุฎุฑ ุงูุฅุนูุงูุงุช ูุงูุฃุฎุจุงุฑ**\n\n๐ **ุชุฐููุฑ:** ุงุฎุชุจุงุฑ ุงูุฑูุงุถูุงุช ููู ุงูุฃุฑุจุนุงุก ุงููุงุฏู\n๐ **ุฅุฌุงุฒุฉ:** ุฅุฌุงุฒุฉ ูุตู ุงูุนุงู ุชุจุฏุฃ 15 ูุจุฑุงูุฑ\n๐ **ุงุฌุชูุงุน:** ุงุฌุชูุงุน ุฃูููุงุก ุงูุฃููุฑ ููู ุงูุฎููุณ ุงูุณุงุนุฉ 10 ุตุจุงุญุงู\n๐ **ุชุฃุฌูู:** ุชู ุชุฃุฌูู ุฑุญูุฉ ุงูุตู ุงูุณุงุฏุณ\n๐ **ูุนุงููุฉ:** ูุนุฑุถ ุงููุชุงุจ ููู ุงูุฃุญุฏ ุงููุงุฏู\n\n๐ **ุขุฎุฑ ุชุญุฏูุซ:** ุงูููู 2:30 ูุณุงุกู',
                'programs': '๐ **ุงูุจุฑุงูุฌ ูุงููุณุงุจูุงุช ุงูุญุงููุฉ**\n\n๐ฏ **ูุณุงุจูุฉ ุงููุฑุขู ุงููุฑูู**\nโข ุงูุชุณุฌูู ููุชูุญ ุญุชู 20 ูุจุฑุงูุฑ\nโข ูููุฑุงุญู ูู ุงูุซุงูุซ ุฅูู ุงูุณุงุฏุณ\n\n๐ฏ **ุจุฑูุงูุฌ ุงูููุงูุจ ุงูุทูุงุจูุฉ**\nโข ูุจุฏุฃ 20 ูุจุฑุงูุฑ\nโข ูุดูู ุงูุฑุณูุ ุงูุฎุทุงุจุฉุ ูุงูุฃูุดุทุฉ ุงููููุฉ\n\n๐ฏ **ูุณุงุจูุฉ ุงูุฑูุงุถูุงุช**\nโข ุงููุฑุญูุฉ ุงูููุงุฆูุฉ 25 ูุจุฑุงูุฑ\n\n๐ฏ **ูุนุฑุถ ุงูุนููู ุงูุณููู**\nโข ูุงุฑุณ 2024\nโข ุงูุชุณุฌูู ููุชูุญ\n\nููุชุณุฌูู ุฃู ุงูุงุณุชูุณุงุฑุ ุงุถุบุท ุนูู ูุณู "ุชูุงุตู ูุนูุง"',
                'files': '๐ **ุงููููุงุช ุงููุชุงุญุฉ ููุชุญููู**\n\nุฌููุน ุงููููุงุช ูุชุงุญุฉ ูู ุงูุฃูุณุงู ุงููุฎุตุตุฉ ููู ุตู:\n\nโข ๐ ุฌุฏูู ุงูุงุฎุชุจุงุฑุงุช ุงูููุงุฆูุฉ\nโข ๐ ูุงุฆูุฉ ุงููุชุจ ุงููุทููุจุฉ\nโข ๐ ูููุฐุฌ ุทูุจ ุฅุฌุงุฒุฉ\nโข ๐ ุฏููู ููู ุงูุฃูุฑ\nโข ๐ ุงูุชูููู ุงูุฏุฑุงุณู 2024\nโข ๐ ููุงุฐุฌ ุงูุชุณุฌูู ูู ุงูุฃูุดุทุฉ\n\nูุชุญููู ุฃู ูููุ ุงุฎุชุฑ ูุณู ุงูุตู ุงููุทููุจ ูู ุงููุงุฆูุฉ',
                'exams': '๐ **ุฌุฏูู ุงูุงุฎุชุจุงุฑุงุช ุงููุงุฏูุฉ**\n\n**ุงููุตู ุงูุฏุฑุงุณู ุงูุซุงูู:**\n\n๐ **ุงูุฑูุงุถูุงุช:**\nโข ุงูุฃุฑุจุนุงุก 10 ูุจุฑุงูุฑ - 8:00 ุตุจุงุญุงู\n\n๐ **ุงููุบุฉ ุงูุนุฑุจูุฉ:**\nโข ุงูุฎููุณ 11 ูุจุฑุงูุฑ - 8:00 ุตุจุงุญุงู\n\n๐ **ุงูุนููู:**\nโข ุงูุฃุญุฏ 14 ูุจุฑุงูุฑ - 8:00 ุตุจุงุญุงู\n\n๐ **ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ:**\nโข ุงูุงุซููู 15 ูุจุฑุงูุฑ - 8:00 ุตุจุงุญุงู\n\nโฐ **ูุฏุฉ ูู ุงุฎุชุจุงุฑ:** ุณุงุนุชุงู\n๐ **ููุงู ุงูุงุฎุชุจุงุฑ:** ุงููุตูู ุงูุฏุฑุงุณูุฉ',
                'contact': '๐ **ูุนูููุงุช ุงูุชูุงุตู**\n\n**ุงููุงุชู:**\nโข 011-234-5678\n\n**ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:**\nโข info@school.edu.sa\n\n**ุงููููุน ุงูุฅููุชุฑููู:**\nโข www.school.edu.sa\n\n**ุงูุนููุงู:**\nโข ุดุงุฑุน ุงูุชุนูููุ ุญู ุงููุฎููุ ุงูุฑูุงุถ\n\n**ุณุงุนุงุช ุงูุนูู:**\nโข ุงูุฃุญุฏ - ุงูุฎููุณ: 7:00 ุต - 2:00 ู\n\n**ูุฏูุฑ ุงููุฏุฑุณุฉ:**\nโข ุฃ. ูุญูุฏ ุฃุญูุฏ\nโข ูููููู ุญุฌุฒ ููุนุฏ ุนุจุฑ ุงููุงุชู'
            };
            
            return defaultContents[serviceKey] || '๐ ุงูุฎุฏูุฉ ุบูุฑ ูุชุงุญุฉ ุญุงููุงู. ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู.';
        }

        // ุฅุฎูุงุก ุฌููุน ุงูุญุงููุงุช
        function hideAllContainers() {
            document.getElementById('servicesContainer').classList.add('hidden');
            document.getElementById('sectionsContainer').classList.add('hidden');
            document.getElementById('contentContainer').classList.add('hidden');
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // ุนุฑุถ/ุฅุฎูุงุก ุงูุชุญููู
        function showLoading(show) {
            document.getElementById('loadingIndicator').classList.toggle('hidden', !show);
            if (show) {
                hideAllContainers();
            }
        }

        // ุชุญุฏูุซ ุญุงูุฉ ุงูุงุชุตุงู
        function updateStatus(status) {
            document.getElementById('connectionStatus').textContent = status;
        }

        // ุฅุถุงูุฉ ุฑุณุงูุฉ
        function addMessage(text, isUser) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble';
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="flex justify-end">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl p-3 max-w-xs shadow">
                            <p class="text-white text-sm">${text}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 max-w-xs border border-blue-200">
                        <div class="flex items-center space-x-2 space-x-reverse mb-1">
                            <div class="w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center">
                                <span class="text-white text-xs">๐ค</span>
                            </div>
                            <span class="text-blue-700 text-xs font-bold">ูุณุงุนุฏ ุงููุฏุฑุณุฉ</span>
                        </div>
                        <p class="text-gray-800 whitespace-pre-line text-sm">${text}</p>
                    </div>
                `;
            }
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // ุนุฑุถ ูุคุดุฑ ุงููุชุงุจุฉ
        function showTypingIndicator() {
            const messagesArea = document.getElementById('messagesArea');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'message-bubble';
            typingDiv.innerHTML = `
                <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl p-3 max-w-xs border border-blue-200">
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span class="text-gray-600 text-xs">${isAIActive ? '๐ค ุฌุงุฑู ุงููุชุงุจุฉ...' : '๐ ุฌุงุฑู ุงูุจุญุซ...'}</span>
                    </div>
                </div>
            `;
            messagesArea.appendChild(typingDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // ุฅุฎูุงุก ูุคุดุฑ ุงููุชุงุจุฉ
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // ุฅุฑุณุงู ุฑุณุงูุฉ
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                showTypingIndicator();
                
                setTimeout(async () => {
                    try {
                        const response = await getAIResponse(message);
                        hideTypingIndicator();
                        addMessage(response, false);
                    } catch (error) {
                        hideTypingIndicator();
                        const fallbackResponse = getSmartResponse(message);
                        addMessage(fallbackResponse, false);
                    }
                }, 1500);
            }
        }

        // ุงูุชุนุงูู ูุน ุถุบุท ุงูููุงุชูุญ
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // ุฅุถุงูุฉ ูุณุชูุน event ููุฒุฑ Enter
        document.getElementById('messageInput').addEventListener('keypress', handleKeyPress);

        // ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุจุฏุก ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
