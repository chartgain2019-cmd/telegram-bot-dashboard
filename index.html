<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØª ØªÙ„Ø¬Ø±Ø§Ù… - Ø®Ø¯Ù…Ø© Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- JotForm Chat Bot Script -->
    <script src='https://cdn.jotfor.ms/agent/embedjs/019932f8eeb67de397162a0d8c2d541451fe/embed.js'></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .message-bubble {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .service-card {
            transition: all 0.3s ease;
            border-radius: 10px;
        }
        .service-card:hover {
            transform: translateY(-3px);
        }
        .chat-container {
            height: calc(100vh - 80px);
            border-radius: 20px 20px 0 0;
        }
        #jotform-chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            width: 300px;
            height: 500px;
        }
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        .typing-dots span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .file-item {
            transition: all 0.3s ease;
        }
        .file-item:hover {
            transform: translateX(-5px);
        }
        #imageModal {
            display: none;
        }
        #imageModal.show {
            display: flex;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-lg">
        <div class="flex items-center justify-between max-w-md mx-auto">
            <div class="flex items-center space-x-3 space-x-reverse">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow">
                    <span class="text-blue-600 text-xl">ğŸ¤–</span>
                </div>
                <div>
                    <h1 class="font-bold text-lg">Ø¨ÙˆØª Ø®Ø¯Ù…Ø© Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</h1>
                    <p class="text-blue-100 text-sm" id="connectionStatus">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="max-w-md mx-auto bg-white chat-container flex flex-col">
        <!-- Navigation Header -->
        <div id="navigationHeader" class="bg-blue-50 p-3 border-b flex items-center justify-between hidden">
            <div class="flex space-x-2 space-x-reverse">
                <button id="backToServices" onclick="showMainServices()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-medium transition-colors shadow hidden">
                    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø¯Ù…Ø§Øª
                </button>
                <button id="backToSections" onclick="showServiceSections(currentService)" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded-lg text-xs font-medium transition-colors shadow hidden">
                    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
                </button>
            </div>
            <span id="currentLevel" class="text-gray-700 font-medium text-xs bg-white/80 px-2 py-1 rounded-full"></span>
        </div>

        <!-- Messages Area -->
        <div id="messagesArea" class="flex-1 p-3 space-y-3 overflow-y-auto bg-gray-50">
            <div class="message-bubble">
                <div class="bg-blue-100 rounded-xl p-3 max-w-xs border border-blue-200">
                    <div class="flex items-center space-x-2 space-x-reverse mb-1">
                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xs">ğŸ¤–</span>
                        </div>
                        <span class="text-blue-700 text-xs font-bold">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</span>
                    </div>
                    <p class="text-gray-800 text-sm font-medium">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø®Ø¯Ù…Ø© Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±! ğŸ‘‹</p>
                    <p class="text-gray-600 text-xs mt-1">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...</p>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="flex justify-center p-3 bg-gray-50">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg p-3 shadow w-full max-w-xs">
                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                    <div class="typing-dots">
                        <span class="bg-white"></span>
                        <span class="bg-white"></span>
                        <span class="bg-white"></span>
                    </div>
                    <p class="font-medium text-sm">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...</p>
                </div>
            </div>
        </div>

        <!-- Services Container -->
        <div id="servicesContainer" class="p-3 bg-gray-50 hidden">
            <div class="message-bubble">
                <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                    <p class="text-gray-800 font-bold mb-2 text-sm">ğŸš€ Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</p>
                    <div class="grid grid-cols-2 gap-2" id="servicesGrid">
                        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sections Container -->
        <div id="sectionsContainer" class="p-3 bg-gray-50 hidden">
            <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‡Ù†Ø§ -->
        </div>

        <!-- Content Container -->
        <div id="contentContainer" class="p-3 bg-gray-50 hidden">
            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ù‡Ù†Ø§ -->
        </div>

        <!-- Input Area -->
        <div class="border-t bg-white p-3">
            <div class="flex items-center space-x-2 space-x-reverse">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."
                    class="flex-1 border border-gray-300 rounded-full px-3 py-2 text-sm focus:outline-none focus:border-blue-500"
                >
                <button onclick="sendMessage()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 transition-all shadow">
                    <svg class="w-4 h-4 transform rotate-180" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- JotForm Chat Container -->
    <div id="jotform-chat-container"></div>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-4 max-w-3xl max-h-3xl mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©</h3>
                <button onclick="closeImageModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <img id="modalImage" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" class="max-w-full max-h-96 object-contain rounded">
            <div class="mt-4 flex justify-center space-x-2 space-x-reverse">
                <button onclick="downloadCurrentImage()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                </button>
                <button onclick="closeImageModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api/data';
        let botData = null;
        let currentService = null;
        let currentSection = null;
        let currentImageUrl = null;

        // Initialize Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        // Load data from server
        async function loadData() {
            showLoading(true);
            updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...');
            
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                botData = await response.json();
                updateStatus('âœ… Ù…ØªØµÙ„ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø©');
                showLoading(false);
                showMainServices();
                
            } catch (error) {
                console.error('Error:', error);
                updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ©');
                showLoading(false);
                useDefaultData();
            }
        }

        function useDefaultData() {
            botData = {
                services: {
                    'schedule': { 
                        name: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ', 
                        icon: 'ğŸ“…',
                        sections: [
                            { 
                                name: 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„', 
                                description: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
                                content: [
                                    { type: 'text', content: 'ğŸ“… **Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„**\n\n**Ø§Ù„Ø£Ø­Ø¯:**\nâ€¢ Ø±ÙŠØ§Ø¶ÙŠØ§Øª (8:00 - 9:00)\nâ€¢ Ø¹Ø±Ø¨ÙŠ (9:00 - 10:00)\nâ€¢ Ø¹Ù„ÙˆÙ… (10:30 - 11:30)\n\n**Ø§Ù„Ø§Ø«Ù†ÙŠÙ†:**\nâ€¢ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (8:00 - 9:00)\nâ€¢ ØªØ§Ø±ÙŠØ® (9:00 - 10:00)\nâ€¢ Ø±ÙŠØ§Ø¶Ø© (10:30 - 11:30)' }
                                ]
                            }
                        ] 
                    },
                    'homework': { 
                        name: 'Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©', 
                        icon: 'ğŸ“',
                        sections: [] 
                    },
                    'ai': { 
                        name: 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ', 
                        icon: 'ğŸ¤–',
                        sections: [] 
                    },
                    'broadcast': { 
                        name: 'Ø§Ù„Ø¨Ø±ÙˆÙƒØ§Ø³Øª', 
                        icon: 'ğŸ“¢',
                        sections: [] 
                    },
                    'programs': { 
                        name: 'Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª', 
                        icon: 'ğŸ†',
                        sections: [] 
                    },
                    'files': { 
                        name: 'Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©', 
                        icon: 'ğŸ“',
                        sections: [] 
                    },
                    'exams': { 
                        name: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', 
                        icon: 'ğŸ“‹',
                        sections: [] 
                    },
                    'contact': { 
                        name: 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§', 
                        icon: 'ğŸ“',
                        sections: [] 
                    }
                }
            };
            showMainServices();
        }

        function updateStatus(status) {
            document.getElementById('connectionStatus').textContent = status;
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').classList.toggle('hidden', !show);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1)
        function showMainServices() {
            hideAllContainers();
            document.getElementById('servicesContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.add('hidden');
            
            const servicesGrid = document.getElementById('servicesGrid');
            servicesGrid.innerHTML = '';

            const serviceButtons = [
                { key: 'schedule', name: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ', icon: 'ğŸ“…', color: 'from-purple-500 to-indigo-500' },
                { key: 'homework', name: 'Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©', icon: 'ğŸ“', color: 'from-red-500 to-pink-500' },
                { key: 'ai', name: 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ', icon: 'ğŸ¤–', color: 'from-cyan-500 to-blue-500' },
                { key: 'broadcast', name: 'Ø§Ù„Ø¨Ø±ÙˆÙƒØ§Ø³Øª', icon: 'ğŸ“¢', color: 'from-green-500 to-teal-500' },
                { key: 'programs', name: 'Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª', icon: 'ğŸ†', color: 'from-orange-500 to-amber-500' },
                { key: 'files', name: 'Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©', icon: 'ğŸ“', color: 'from-blue-500 to-cyan-500' },
                { key: 'exams', name: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', icon: 'ğŸ“‹', color: 'from-pink-500 to-rose-500' },
                { key: 'contact', name: 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§', icon: 'ğŸ“', color: 'from-indigo-500 to-purple-500' }
            ];

            serviceButtons.forEach(button => {
                const service = botData.services[button.key];
                if (!service) return;
                
                const buttonElement = document.createElement('button');
                buttonElement.className = `bg-gradient-to-r ${button.color} hover:from-${button.color.split('-')[1]}-600 hover:to-${button.color.split('-')[3]}-600 text-white p-2 rounded-lg text-xs font-medium transition-all service-card flex flex-col items-center justify-center h-14`;
                buttonElement.innerHTML = `
                    <span class="text-sm mb-1">${service.icon || button.icon}</span>
                    <span class="text-xs">${service.name}</span>
                `;
                buttonElement.onclick = () => selectService(button.key);
                servicesGrid.appendChild(buttonElement);
            });
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2)
        async function selectService(serviceKey) {
            currentService = serviceKey;
            const service = botData.services[serviceKey];
            
            if (!service) {
                useDefaultServiceResponse(serviceKey);
                return;
            }
            
            if (service.sections && service.sections.length > 0) {
                showServiceSections(serviceKey);
            } else {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                showLoading(true);
                try {
                    const response = await fetch(API_URL);
                    if (response.ok) {
                        const liveData = await response.json();
                        const liveService = liveData.services[serviceKey];
                        if (liveService && liveService.sections) {
                            service.sections = liveService.sections;
                        }
                    }
                } catch (error) {
                    console.error('Error fetching service data:', error);
                }
                showLoading(false);
                
                if (service.sections && service.sections.length > 0) {
                    showServiceSections(serviceKey);
                } else {
                    showServiceContent(serviceKey, null);
                }
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø®Ø¯Ù…Ø© (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2)
        function showServiceSections(serviceKey) {
            hideAllContainers();
            document.getElementById('sectionsContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.remove('hidden');
            document.getElementById('backToServices').classList.remove('hidden');
            document.getElementById('backToSections').classList.add('hidden');
            document.getElementById('currentLevel').textContent = botData.services[serviceKey].name;
            
            const sectionsContainer = document.getElementById('sectionsContainer');
            sectionsContainer.innerHTML = '';

            const service = botData.services[serviceKey];
            if (!service.sections || service.sections.length === 0) {
                sectionsContainer.innerHTML = `
                    <div class="message-bubble">
                        <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                            <p class="text-gray-800 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            let sectionsHtml = `
                <div class="message-bubble">
                    <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                        <p class="text-gray-800 font-bold mb-2 text-sm">ğŸ“‚ Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</p>
                        <div class="grid grid-cols-2 gap-2">
            `;

            service.sections.forEach((section, index) => {
                sectionsHtml += `
                    <button onclick="selectSection('${serviceKey}', ${index})" class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white p-2 rounded-lg text-xs font-medium transition-all service-card flex flex-col items-center justify-center h-14">
                        <span class="text-sm mb-1">ğŸ“</span>
                        <span class="text-xs">${section.name}</span>
                    </button>
                `;
            });

            sectionsHtml += `
                        </div>
                    </div>
                </div>
            `;

            sectionsContainer.innerHTML = sectionsHtml;
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3)
        async function selectSection(serviceKey, sectionIndex) {
            currentService = serviceKey;
            currentSection = sectionIndex;
            
            const service = botData.services[serviceKey];
            const section = service.sections[sectionIndex];
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
            showLoading(true);
            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    const liveData = await response.json();
                    const liveService = liveData.services[serviceKey];
                    if (liveService && liveService.sections && liveService.sections[sectionIndex]) {
                        section.content = liveService.sections[sectionIndex].content;
                    }
                }
            } catch (error) {
                console.error('Error fetching section content:', error);
            }
            showLoading(false);
            
            showServiceContent(serviceKey, sectionIndex);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¯Ù…Ø© (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3)
        function showServiceContent(serviceKey, sectionIndex) {
            hideAllContainers();
            document.getElementById('contentContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.remove('hidden');
            document.getElementById('backToSections').classList.remove('hidden');
            document.getElementById('backToServices').classList.add('hidden');
            
            const service = botData.services[serviceKey];
            let contentHtml = '';
            
            if (sectionIndex !== null) {
                const section = service.sections[sectionIndex];
                document.getElementById('currentLevel').textContent = `${service.name} - ${section.name}`;
                
                contentHtml = `
                    <div class="message-bubble">
                        <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                            <h3 class="font-bold text-sm mb-1 text-gray-800">${section.name}</h3>
                            ${section.description ? `<p class="text-gray-600 mb-2 bg-white/50 p-2 rounded text-xs">${section.description}</p>` : ''}
                `;
                
                if (section.content && section.content.length > 0) {
                    section.content.forEach(item => {
                        if (item.type === 'text') {
                            contentHtml += `
                                <div class="bg-white p-3 rounded-lg border border-gray-200 mb-2">
                                    <p class="text-gray-800 whitespace-pre-line text-xs">${item.content}</p>
                                </div>
                            `;
                        } else if (item.type === 'pdf' || item.type === 'file') {
                            const fileUrl = item.fileUrl || item.url;
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 flex items-center justify-between file-item">
                                    <div class="flex items-center">
                                        <span class="ml-2 text-lg">ğŸ“„</span>
                                        <div>
                                            <p class="text-gray-800 font-medium text-xs">${item.title || item.name}</p>
                                            <p class="text-gray-500 text-xs">Ù…Ù„Ù PDF</p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-1 space-x-reverse">
                                        <a href="${fileUrl}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                            Ù…Ø¹Ø§ÙŠÙ†Ø©
                                        </a>
                                        <a href="${fileUrl}" download class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                            ØªØ­Ù…ÙŠÙ„
                                        </a>
                                    </div>
                                </div>
                            `;
                        } else if (item.type === 'image') {
                            const fileUrl = item.fileUrl || item.url;
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 file-item">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center">
                                            <span class="ml-2 text-lg">ğŸ–¼ï¸</span>
                                            <div>
                                                <p class="text-gray-800 font-medium text-xs">${item.title || item.name}</p>
                                                <p class="text-gray-500 text-xs">ØµÙˆØ±Ø©</p>
                                            </div>
                                        </div>
                                        <div class="flex space-x-1 space-x-reverse">
                                            <button onclick="openImageModal('${fileUrl}')" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                                Ù…Ø¹Ø§ÙŠÙ†Ø©
                                            </button>
                                            <a href="${fileUrl}" download class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                                ØªØ­Ù…ÙŠÙ„
                                            </a>
                                        </div>
                                    </div>
                                    <img src="${fileUrl}" alt="${item.title || item.name}" class="w-full rounded-lg cursor-pointer" onclick="openImageModal('${fileUrl}')">
                                </div>
                            `;
                        } else if (item.type === 'link') {
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 file-item">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="ml-2 text-lg">ğŸ”—</span>
                                            <div>
                                                <p class="text-gray-800 font-medium text-xs">${item.title}</p>
                                                <p class="text-gray-500 text-xs">Ø±Ø§Ø¨Ø·</p>
                                            </div>
                                        </div>
                                        <a href="${item.url}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                            ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·
                                        </a>
                                    </div>
                                </div>
                            `;
                        }
                    });
                } else {
                    contentHtml += `
                        <div class="bg-white p-3 rounded-lg border border-gray-200">
                            <p class="text-gray-800 text-sm">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….</p>
                        </div>
                    `;
                }
                
                contentHtml += `</div></div>`;
            } else {
                document.getElementById('currentLevel').textContent = service.name;
                const defaultContent = getDefaultServiceContent(serviceKey);
                contentHtml = `
                    <div class="message-bubble">
                        <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                            <h3 class="font-bold text-sm mb-2 text-gray-800">${service.name}</h3>
                            <div class="bg-white p-3 rounded-lg border border-gray-200">
                                <p class="text-gray-800 whitespace-pre-line text-xs">${defaultContent}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentContainer').innerHTML = contentHtml;
        }

        // ÙØªØ­ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
        function openImageModal(imageUrl) {
            currentImageUrl = imageUrl;
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('imageModal').classList.remove('hidden');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
            currentImageUrl = null;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function downloadCurrentImage() {
            if (currentImageUrl) {
                const link = document.createElement('a');
                link.href = currentImageUrl;
                link.download = 'ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.jpg';
                link.click();
            }
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
        function hideAllContainers() {
            document.getElementById('servicesContainer').classList.add('hidden');
            document.getElementById('sectionsContainer').classList.add('hidden');
            document.getElementById('contentContainer').classList.add('hidden');
        }

        // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª
        function getDefaultServiceContent(serviceKey) {
            const defaultContents = {
                'ai': 'ğŸ¤– **Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ**\n\nÙ…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.\n\nÙ…Ø§ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ³Ø£Ù„ Ø¹Ù†Ù‡ØŸ',
                'broadcast': 'ğŸ“¢ **Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª**\n\nâ€¢ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±: Ø§Ù„Ø®Ù…ÙŠØ³ Ø§Ù„Ù‚Ø§Ø¯Ù…\nâ€¢ Ø¥Ø¬Ø§Ø²Ø© Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…: ØªØ¨Ø¯Ø£ 15 ÙØ¨Ø±Ø§ÙŠØ±\nâ€¢ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª: Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡',
                'exams': 'ğŸ“‹ **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©**\n\nâ€¢ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª: Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ 10 ÙØ¨Ø±Ø§ÙŠØ±\nâ€¢ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: Ø§Ù„Ø®Ù…ÙŠØ³ 11 ÙØ¨Ø±Ø§ÙŠØ±\nâ€¢ Ø§Ù„Ø¹Ù„ÙˆÙ…: Ø§Ù„Ø£Ø­Ø¯ 14 ÙØ¨Ø±Ø§ÙŠØ±',
                'contact': 'ğŸ“ **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„**\n\nâ€¢ Ø§Ù„Ù‡Ø§ØªÙ: 011-234-5678\nâ€¢ Ø§Ù„Ø¨Ø±ÙŠØ¯: info@school.edu.sa\nâ€¢ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶',
                'homework': 'ğŸ“ **Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©**\n\nâ€¢ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª: Ø­Ù„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Øµ 45-47\nâ€¢ Ø§Ù„Ø¹Ø±Ø¨ÙŠ: ÙƒØªØ§Ø¨Ø© Ù…ÙˆØ¶ÙˆØ¹ ØªØ¹Ø¨ÙŠØ±\nâ€¢ Ø§Ù„Ø¹Ù„ÙˆÙ…: Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«\nâ€¢ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ: Ø­ÙØ¸ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',
                'programs': 'ğŸ† **Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª**\n\nâ€¢ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…\nâ€¢ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…ÙˆØ§Ù‡Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©\nâ€¢ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª\nâ€¢ Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø³Ù†ÙˆÙŠ'
            };
            return defaultContents[serviceKey] || 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹.';
        }

        function useDefaultServiceResponse(service) {
            const response = getDefaultServiceContent(service);
            addMessage(response, false);
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                setTimeout(() => {
                    const responses = [
                        "Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ! Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ",
                        "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø³Ø¤Ø§Ù„ÙƒØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø®Ø¯Ù…Ø© Ù…Ø­Ø¯Ø¯Ø©ØŸ",
                        "Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£ÙØ¶Ù„ØŒ Ø§Ø®ØªØ± Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, false);
                }, 1000);
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
        function addMessage(text, isUser) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble';
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="flex justify-end">
                        <div class="bg-blue-500 text-white rounded-xl p-3 max-w-xs shadow">
                            <p class="text-white text-sm">${text}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="bg-blue-100 rounded-xl p-3 max-w-xs border border-blue-200">
                        <p class="text-gray-800 text-sm whitespace-pre-line">${text}</p>
                    </div>
                `;
            }
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Enter
        document.getElementById('messageInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
