<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوت تلجرام - خدمة أولياء الأمور</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- JotForm Chat Bot Script -->
    <script src='https://cdn.jotfor.ms/agent/embedjs/019932f8eeb67de397162a0d8c2d541451fe/embed.js'></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .message-bubble {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .service-card {
            transition: all 0.3s ease;
            border-radius: 10px;
        }
        .service-card:hover {
            transform: translateY(-3px);
        }
        .chat-container {
            height: calc(100vh - 80px);
            border-radius: 20px 20px 0 0;
        }
        #jotform-chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            width: 300px;
            height: 500px;
        }
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        .typing-dots span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .file-item {
            transition: all 0.3s ease;
        }
        .file-item:hover {
            transform: translateX(-5px);
        }
        #imageModal {
            display: none;
        }
        #imageModal.show {
            display: flex;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-lg">
        <div class="flex items-center justify-between max-w-md mx-auto">
            <div class="flex items-center space-x-3 space-x-reverse">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow">
                    <span class="text-blue-600 text-xl">🤖</span>
                </div>
                <div>
                    <h1 class="font-bold text-lg">بوت خدمة أولياء الأمور</h1>
                    <p class="text-blue-100 text-sm" id="connectionStatus">🔄 جاري الاتصال بالخادم...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="max-w-md mx-auto bg-white chat-container flex flex-col">
        <!-- Navigation Header -->
        <div id="navigationHeader" class="bg-blue-50 p-3 border-b flex items-center justify-between hidden">
            <div class="flex space-x-2 space-x-reverse">
                <button id="backToServices" onclick="showMainServices()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-medium transition-colors shadow hidden">
                    ← العودة للخدمات
                </button>
                <button id="backToSections" onclick="showServiceSections(currentService)" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded-lg text-xs font-medium transition-colors shadow hidden">
                    ← العودة للأقسام
                </button>
            </div>
            <span id="currentLevel" class="text-gray-700 font-medium text-xs bg-white/80 px-2 py-1 rounded-full"></span>
        </div>

        <!-- Messages Area -->
        <div id="messagesArea" class="flex-1 p-3 space-y-3 overflow-y-auto bg-gray-50">
            <div class="message-bubble">
                <div class="bg-blue-100 rounded-xl p-3 max-w-xs border border-blue-200">
                    <div class="flex items-center space-x-2 space-x-reverse mb-1">
                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xs">🤖</span>
                        </div>
                        <span class="text-blue-700 text-xs font-bold">مساعد المدرسة</span>
                    </div>
                    <p class="text-gray-800 text-sm font-medium">مرحباً بك في بوت خدمة أولياء الأمور! 👋</p>
                    <p class="text-gray-600 text-xs mt-1">جاري تحميل البيانات من الخادم...</p>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="flex justify-center p-3 bg-gray-50">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg p-3 shadow w-full max-w-xs">
                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                    <div class="typing-dots">
                        <span class="bg-white"></span>
                        <span class="bg-white"></span>
                        <span class="bg-white"></span>
                    </div>
                    <p class="font-medium text-sm">جاري تحميل البيانات من الخادم...</p>
                </div>
            </div>
        </div>

        <!-- Services Container -->
        <div id="servicesContainer" class="p-3 bg-gray-50 hidden">
            <div class="message-bubble">
                <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                    <p class="text-gray-800 font-bold mb-2 text-sm">🚀 اختر الخدمة المطلوبة:</p>
                    <div class="grid grid-cols-2 gap-2" id="servicesGrid">
                        <!-- الأزرار سيتم إضافتها هنا -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sections Container -->
        <div id="sectionsContainer" class="p-3 bg-gray-50 hidden">
            <!-- الأقسام سيتم إضافتها هنا -->
        </div>

        <!-- Content Container -->
        <div id="contentContainer" class="p-3 bg-gray-50 hidden">
            <!-- المحتوى سيتم إضافته هنا -->
        </div>

        <!-- Input Area -->
        <div class="border-t bg-white p-3">
            <div class="flex items-center space-x-2 space-x-reverse">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="اكتب سؤالك هنا..."
                    class="flex-1 border border-gray-300 rounded-full px-3 py-2 text-sm focus:outline-none focus:border-blue-500"
                >
                <button onclick="sendMessage()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 transition-all shadow">
                    <svg class="w-4 h-4 transform rotate-180" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- JotForm Chat Container -->
    <div id="jotform-chat-container"></div>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-4 max-w-3xl max-h-3xl mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">معاينة الصورة</h3>
                <button onclick="closeImageModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <img id="modalImage" src="" alt="معاينة الصورة" class="max-w-full max-h-96 object-contain rounded">
            <div class="mt-4 flex justify-center space-x-2 space-x-reverse">
                <button onclick="downloadCurrentImage()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    📥 تحميل الصورة
                </button>
                <button onclick="closeImageModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                    إغلاق
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api/data';
        let botData = null;
        let currentService = null;
        let currentSection = null;
        let currentImageUrl = null;

        // Initialize Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        // Load data from server
        async function loadData() {
            showLoading(true);
            updateStatus('🔄 جاري الاتصال بالخادم...');
            
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error('فشل في جلب البيانات');
                }
                
                botData = await response.json();
                updateStatus('✅ متصل - البيانات محدثة');
                showLoading(false);
                showMainServices();
                
            } catch (error) {
                console.error('Error:', error);
                updateStatus('❌ خطأ في الاتصال - استخدام بيانات محلية');
                showLoading(false);
                useDefaultData();
            }
        }

        function useDefaultData() {
            botData = {
                services: {
                    'schedule': { 
                        name: 'الجدول الدراسي', 
                        icon: '📅',
                        sections: [
                            { 
                                name: 'الصف الأول', 
                                description: 'الجدول الأسبوعي للصف الأول',
                                content: [
                                    { type: 'text', content: '📅 **الجدول الدراسي للصف الأول**\n\n**الأحد:**\n• رياضيات (8:00 - 9:00)\n• عربي (9:00 - 10:00)\n• علوم (10:30 - 11:30)\n\n**الاثنين:**\n• إنجليزي (8:00 - 9:00)\n• تاريخ (9:00 - 10:00)\n• رياضة (10:30 - 11:30)' }
                                ]
                            }
                        ] 
                    },
                    'homework': { 
                        name: 'الواجبات المنزلية', 
                        icon: '📝',
                        sections: [] 
                    },
                    'ai': { 
                        name: 'المساعد الذكي', 
                        icon: '🤖',
                        sections: [] 
                    },
                    'broadcast': { 
                        name: 'البروكاست', 
                        icon: '📢',
                        sections: [] 
                    },
                    'programs': { 
                        name: 'البرامج والمسابقات', 
                        icon: '🏆',
                        sections: [] 
                    },
                    'files': { 
                        name: 'الملفات المرسلة', 
                        icon: '📁',
                        sections: [] 
                    },
                    'exams': { 
                        name: 'الاختبارات', 
                        icon: '📋',
                        sections: [] 
                    },
                    'contact': { 
                        name: 'تواصل معنا', 
                        icon: '📞',
                        sections: [] 
                    }
                }
            };
            showMainServices();
        }

        function updateStatus(status) {
            document.getElementById('connectionStatus').textContent = status;
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').classList.toggle('hidden', !show);
        }

        // إظهار الخدمات الرئيسية (المستوى 1)
        function showMainServices() {
            hideAllContainers();
            document.getElementById('servicesContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.add('hidden');
            
            const servicesGrid = document.getElementById('servicesGrid');
            servicesGrid.innerHTML = '';

            const serviceButtons = [
                { key: 'schedule', name: 'الجدول الدراسي', icon: '📅', color: 'from-purple-500 to-indigo-500' },
                { key: 'homework', name: 'الواجبات المنزلية', icon: '📝', color: 'from-red-500 to-pink-500' },
                { key: 'ai', name: 'المساعد الذكي', icon: '🤖', color: 'from-cyan-500 to-blue-500' },
                { key: 'broadcast', name: 'البروكاست', icon: '📢', color: 'from-green-500 to-teal-500' },
                { key: 'programs', name: 'البرامج والمسابقات', icon: '🏆', color: 'from-orange-500 to-amber-500' },
                { key: 'files', name: 'الملفات المرسلة', icon: '📁', color: 'from-blue-500 to-cyan-500' },
                { key: 'exams', name: 'الاختبارات', icon: '📋', color: 'from-pink-500 to-rose-500' },
                { key: 'contact', name: 'تواصل معنا', icon: '📞', color: 'from-indigo-500 to-purple-500' }
            ];

            serviceButtons.forEach(button => {
                const service = botData.services[button.key];
                if (!service) return;
                
                const buttonElement = document.createElement('button');
                buttonElement.className = `bg-gradient-to-r ${button.color} hover:from-${button.color.split('-')[1]}-600 hover:to-${button.color.split('-')[3]}-600 text-white p-2 rounded-lg text-xs font-medium transition-all service-card flex flex-col items-center justify-center h-14`;
                buttonElement.innerHTML = `
                    <span class="text-sm mb-1">${service.icon || button.icon}</span>
                    <span class="text-xs">${service.name}</span>
                `;
                buttonElement.onclick = () => selectService(button.key);
                servicesGrid.appendChild(buttonElement);
            });
        }

        // اختيار خدمة (المستوى 2)
        async function selectService(serviceKey) {
            currentService = serviceKey;
            const service = botData.services[serviceKey];
            
            if (!service) {
                useDefaultServiceResponse(serviceKey);
                return;
            }
            
            if (service.sections && service.sections.length > 0) {
                showServiceSections(serviceKey);
            } else {
                // جلب البيانات الحية من الخادم
                showLoading(true);
                try {
                    const response = await fetch(API_URL);
                    if (response.ok) {
                        const liveData = await response.json();
                        const liveService = liveData.services[serviceKey];
                        if (liveService && liveService.sections) {
                            service.sections = liveService.sections;
                        }
                    }
                } catch (error) {
                    console.error('Error fetching service data:', error);
                }
                showLoading(false);
                
                if (service.sections && service.sections.length > 0) {
                    showServiceSections(serviceKey);
                } else {
                    showServiceContent(serviceKey, null);
                }
            }
        }

        // إظهار أقسام الخدمة (المستوى 2)
        function showServiceSections(serviceKey) {
            hideAllContainers();
            document.getElementById('sectionsContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.remove('hidden');
            document.getElementById('backToServices').classList.remove('hidden');
            document.getElementById('backToSections').classList.add('hidden');
            document.getElementById('currentLevel').textContent = botData.services[serviceKey].name;
            
            const sectionsContainer = document.getElementById('sectionsContainer');
            sectionsContainer.innerHTML = '';

            const service = botData.services[serviceKey];
            if (!service.sections || service.sections.length === 0) {
                sectionsContainer.innerHTML = `
                    <div class="message-bubble">
                        <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                            <p class="text-gray-800 text-sm">لا توجد أقسام متاحة حالياً.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            let sectionsHtml = `
                <div class="message-bubble">
                    <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                        <p class="text-gray-800 font-bold mb-2 text-sm">📂 اختر القسم المطلوب:</p>
                        <div class="grid grid-cols-2 gap-2">
            `;

            service.sections.forEach((section, index) => {
                sectionsHtml += `
                    <button onclick="selectSection('${serviceKey}', ${index})" class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white p-2 rounded-lg text-xs font-medium transition-all service-card flex flex-col items-center justify-center h-14">
                        <span class="text-sm mb-1">📁</span>
                        <span class="text-xs">${section.name}</span>
                    </button>
                `;
            });

            sectionsHtml += `
                        </div>
                    </div>
                </div>
            `;

            sectionsContainer.innerHTML = sectionsHtml;
        }

        // اختيار قسم (المستوى 3)
        async function selectSection(serviceKey, sectionIndex) {
            currentService = serviceKey;
            currentSection = sectionIndex;
            
            const service = botData.services[serviceKey];
            const section = service.sections[sectionIndex];
            
            // جلب المحتوى الحقيقي من الخادم
            showLoading(true);
            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    const liveData = await response.json();
                    const liveService = liveData.services[serviceKey];
                    if (liveService && liveService.sections && liveService.sections[sectionIndex]) {
                        section.content = liveService.sections[sectionIndex].content;
                    }
                }
            } catch (error) {
                console.error('Error fetching section content:', error);
            }
            showLoading(false);
            
            showServiceContent(serviceKey, sectionIndex);
        }

        // إظهار محتوى الخدمة (المستوى 3)
        function showServiceContent(serviceKey, sectionIndex) {
            hideAllContainers();
            document.getElementById('contentContainer').classList.remove('hidden');
            document.getElementById('navigationHeader').classList.remove('hidden');
            document.getElementById('backToSections').classList.remove('hidden');
            document.getElementById('backToServices').classList.add('hidden');
            
            const service = botData.services[serviceKey];
            let contentHtml = '';
            
            if (sectionIndex !== null) {
                const section = service.sections[sectionIndex];
                document.getElementById('currentLevel').textContent = `${service.name} - ${section.name}`;
                
                contentHtml = `
                    <div class="message-bubble">
                        <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                            <h3 class="font-bold text-sm mb-1 text-gray-800">${section.name}</h3>
                            ${section.description ? `<p class="text-gray-600 mb-2 bg-white/50 p-2 rounded text-xs">${section.description}</p>` : ''}
                `;
                
                if (section.content && section.content.length > 0) {
                    section.content.forEach(item => {
                        if (item.type === 'text') {
                            contentHtml += `
                                <div class="bg-white p-3 rounded-lg border border-gray-200 mb-2">
                                    <p class="text-gray-800 whitespace-pre-line text-xs">${item.content}</p>
                                </div>
                            `;
                        } else if (item.type === 'pdf' || item.type === 'file') {
                            const fileUrl = item.fileUrl || item.url;
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 flex items-center justify-between file-item">
                                    <div class="flex items-center">
                                        <span class="ml-2 text-lg">📄</span>
                                        <div>
                                            <p class="text-gray-800 font-medium text-xs">${item.title || item.name}</p>
                                            <p class="text-gray-500 text-xs">ملف PDF</p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-1 space-x-reverse">
                                        <a href="${fileUrl}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                            معاينة
                                        </a>
                                        <a href="${fileUrl}" download class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                            تحميل
                                        </a>
                                    </div>
                                </div>
                            `;
                        } else if (item.type === 'image') {
                            const fileUrl = item.fileUrl || item.url;
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 file-item">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center">
                                            <span class="ml-2 text-lg">🖼️</span>
                                            <div>
                                                <p class="text-gray-800 font-medium text-xs">${item.title || item.name}</p>
                                                <p class="text-gray-500 text-xs">صورة</p>
                                            </div>
                                        </div>
                                        <div class="flex space-x-1 space-x-reverse">
                                            <button onclick="openImageModal('${fileUrl}')" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                                معاينة
                                            </button>
                                            <a href="${fileUrl}" download class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                                تحميل
                                            </a>
                                        </div>
                                    </div>
                                    <img src="${fileUrl}" alt="${item.title || item.name}" class="w-full rounded-lg cursor-pointer" onclick="openImageModal('${fileUrl}')">
                                </div>
                            `;
                        } else if (item.type === 'link') {
                            contentHtml += `
                                <div class="bg-white p-2 rounded-lg border border-gray-200 mb-2 file-item">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="ml-2 text-lg">🔗</span>
                                            <div>
                                                <p class="text-gray-800 font-medium text-xs">${item.title}</p>
                                                <p class="text-gray-500 text-xs">رابط</p>
                                            </div>
                                        </div>
                                        <a href="${item.url}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                            فتح الرابط
                                        </a>
                                    </div>
                                </div>
                            `;
                        }
                    });
                } else {
                    contentHtml += `
                        <div class="bg-white p-3 rounded-lg border border-gray-200">
                            <p class="text-gray-800 text-sm">لا يوجد محتوى متاح حالياً في هذا القسم.</p>
                        </div>
                    `;
                }
                
                contentHtml += `</div></div>`;
            } else {
                document.getElementById('currentLevel').textContent = service.name;
                const defaultContent = getDefaultServiceContent(serviceKey);
                contentHtml = `
                    <div class="message-bubble">
                        <div class="bg-blue-100 rounded-xl p-3 border border-blue-200">
                            <h3 class="font-bold text-sm mb-2 text-gray-800">${service.name}</h3>
                            <div class="bg-white p-3 rounded-lg border border-gray-200">
                                <p class="text-gray-800 whitespace-pre-line text-xs">${defaultContent}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentContainer').innerHTML = contentHtml;
        }

        // فتح معاينة الصورة
        function openImageModal(imageUrl) {
            currentImageUrl = imageUrl;
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('imageModal').classList.remove('hidden');
        }

        // إغلاق معاينة الصورة
        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
            currentImageUrl = null;
        }

        // تحميل الصورة الحالية
        function downloadCurrentImage() {
            if (currentImageUrl) {
                const link = document.createElement('a');
                link.href = currentImageUrl;
                link.download = 'صورة المدرسة.jpg';
                link.click();
            }
        }

        // إخفاء جميع الحاويات
        function hideAllContainers() {
            document.getElementById('servicesContainer').classList.add('hidden');
            document.getElementById('sectionsContainer').classList.add('hidden');
            document.getElementById('contentContainer').classList.add('hidden');
        }

        // المحتوى الافتراضي للخدمات
        function getDefaultServiceContent(serviceKey) {
            const defaultContents = {
                'ai': '🤖 **المساعد الذكي**\n\nمرحباً! أنا مساعدك الذكي للرد على استفساراتك المدرسية.\n\nما الذي تريد أن تسأل عنه؟',
                'broadcast': '📢 **آخر الإعلانات**\n\n• اجتماع أولياء الأمور: الخميس القادم\n• إجازة نصف العام: تبدأ 15 فبراير\n• اختبار الرياضيات: الأربعاء',
                'exams': '📋 **الاختبارات القادمة**\n\n• الرياضيات: الأربعاء 10 فبراير\n• اللغة العربية: الخميس 11 فبراير\n• العلوم: الأحد 14 فبراير',
                'contact': '📞 **معلومات التواصل**\n\n• الهاتف: 011-234-5678\n• البريد: info@school.edu.sa\n• العنوان: شارع التعليم، الرياض',
                'homework': '📝 **الواجبات المطلوبة**\n\n• الرياضيات: حل التمارين ص 45-47\n• العربي: كتابة موضوع تعبير\n• العلوم: قراءة الفصل الثالث\n• الإنجليزي: حفظ المفردات الجديدة',
                'programs': '🏆 **البرامج والمسابقات**\n\n• مسابقة القرآن الكريم\n• برنامج المواهب الطلابية\n• مسابقة الرياضيات\n• معرض العلوم السنوي'
            };
            return defaultContents[serviceKey] || 'المحتوى غير متوفر حالياً.';
        }

        function useDefaultServiceResponse(service) {
            const response = getDefaultServiceContent(service);
            addMessage(response, false);
        }

        // إرسال رسالة
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                setTimeout(() => {
                    const responses = [
                        "شكراً على سؤالك! هل يمكنني مساعدتك في شيء آخر؟",
                        "تم استلام سؤالك، هل تريد الاستفسار عن خدمة محددة؟",
                        "للمساعدة الأفضل، اختر إحدى الخدمات من الأعلى"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, false);
                }, 1000);
            }
        }

        // إضافة رسالة
        function addMessage(text, isUser) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble';
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="flex justify-end">
                        <div class="bg-blue-500 text-white rounded-xl p-3 max-w-xs shadow">
                            <p class="text-white text-sm">${text}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="bg-blue-100 rounded-xl p-3 max-w-xs border border-blue-200">
                        <p class="text-gray-800 text-sm whitespace-pre-line">${text}</p>
                    </div>
                `;
            }
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // التعامل مع زر Enter
        document.getElementById('messageInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // بدء التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
