<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم - إدارة خدمات البوت</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal {
            backdrop-filter: blur(5px);
        }
        .login-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .file-preview {
            max-height: 200px;
            object-fit: contain;
        }
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .service-btn.active {
            background-color: #dbeafe;
            color: #1e40af;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-full">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center login-container">
        <div class="max-w-md w-full mx-4">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">🔐</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900">تسجيل الدخول</h2>
                    <p class="text-gray-600 mt-2">لوحة تحكم إدارة البوت</p>
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">اسم المستخدم</label>
                        <input 
                            type="text" 
                            id="username" 
                            required
                            class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                            placeholder="أدخل اسم المستخدم"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">كلمة المرور</label>
                        <input 
                            type="password" 
                            id="password" 
                            required
                            class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                            placeholder="أدخل كلمة المرور"
                        >
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="flex items-center">
                            <input type="checkbox" id="rememberMe" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="mr-2 text-sm text-gray-600">تذكرني</span>
                        </label>
                        <button type="button" class="text-sm text-blue-600 hover:text-blue-800">نسيت كلمة المرور؟</button>
                    </div>
                    
                    <button 
                        type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 transform hover:scale-105"
                    >
                        🔐 تسجيل الدخول
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <p class="text-sm text-gray-600 font-medium">بيانات الدخول الافتراضية:</p>
                        <p class="text-sm text-gray-500 mt-1">اسم المستخدم: admin</p>
                        <p class="text-sm text-gray-500">كلمة المرور: 123456</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                            <span class="text-white text-xl">⚙️</span>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">لوحة تحكم البوت</h1>
                            <p class="text-gray-600">إدارة خدمات أولياء الأمور</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="text-sm text-gray-600">
                            <span id="adminName" class="font-medium">مرحباً، المشرف</span>
                        </div>
                        <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 space-x-reverse">
                            <span>🚪</span>
                            <span>تسجيل الخروج</span>
                        </button>
                        <button onclick="saveChanges()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                            💾 حفظ في الخادم
                        </button>
                        <button onclick="loadDataFromServer()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                            🔄 تحميل البيانات
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Sidebar -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">الخدمات المتاحة</h2>
                        <div class="space-y-2" id="servicesList">
                            <button data-service="schedule" class="service-btn w-full text-right p-3 rounded-lg bg-purple-50 hover:bg-purple-100 text-purple-800 transition-colors border border-transparent">
                                📅 الجدول الدراسي
                            </button>
                            <button data-service="homework" class="service-btn w-full text-right p-3 rounded-lg bg-red-50 hover:bg-red-100 text-red-800 transition-colors border border-transparent">
                                📝 الواجبات
                            </button>
                            <button data-service="ai" class="service-btn w-full text-right p-3 rounded-lg bg-cyan-50 hover:bg-cyan-100 text-cyan-800 transition-colors border border-transparent">
                                🤖 ربوت الذكاء الاصطناعي
                            </button>
                            <button data-service="broadcast" class="service-btn w-full text-right p-3 rounded-lg bg-green-50 hover:bg-green-100 text-green-800 transition-colors border border-transparent">
                                📢 البروكاست
                            </button>
                            <button data-service="programs" class="service-btn w-full text-right p-3 rounded-lg bg-orange-50 hover:bg-orange-100 text-orange-800 transition-colors border border-transparent">
                                🏆 البرامج والمسابقات
                            </button>
                            <button data-service="files" class="service-btn w-full text-right p-3 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-800 transition-colors border border-transparent">
                                📁 الملفات المرسلة
                            </button>
                            <button data-service="exams" class="service-btn w-full text-right p-3 rounded-lg bg-pink-50 hover:bg-pink-100 text-pink-800 transition-colors border border-transparent">
                                📋 الاختبارات
                            </button>
                            <button data-service="contact" class="service-btn w-full text-right p-3 rounded-lg bg-indigo-50 hover:bg-indigo-100 text-indigo-800 transition-colors border border-transparent">
                                📞 تواصل معنا
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="lg:col-span-3">
                    <div class="bg-white rounded-lg shadow-md">
                        <!-- Service Header -->
                        <div class="border-b px-6 py-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h2 id="serviceTitle" class="text-xl font-semibold text-gray-900">اختر خدمة للتحرير</h2>
                                    <p id="serviceDescription" class="text-gray-600">قم بتحديد خدمة من القائمة الجانبية</p>
                                </div>
                                <button id="addSectionBtn" onclick="showAddSectionModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors hidden">
                                    ➕ إضافة قسم جديد
                                </button>
                            </div>
                        </div>

                        <!-- Service Content -->
                        <div id="serviceContent" class="p-6">
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">📋</div>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">لم يتم تحديد خدمة</h3>
                                <p class="text-gray-600">اختر خدمة من القائمة الجانبية لبدء التحرير</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Section Modal -->
        <div id="addSectionModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">إضافة قسم جديد</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">اسم القسم</label>
                            <input type="text" id="sectionName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="مثال: الصف الأول">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">وصف القسم</label>
                            <textarea id="sectionDescription" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" rows="3" placeholder="وصف مختصر للقسم"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">نوع المحتوى</label>
                            <select id="sectionType" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                <option value="text">نص</option>
                                <option value="files">ملفات</option>
                                <option value="links">روابط</option>
                                <option value="mixed">مختلط</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t flex justify-end space-x-3 space-x-reverse">
                    <button onclick="hideAddSectionModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">إلغاء</button>
                    <button onclick="addSection()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">إضافة القسم</button>
                </div>
            </div>
        </div>

        <!-- Add Content Modal -->
        <div id="addContentModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">إضافة محتوى</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">نوع المحتوى</label>
                            <select id="contentType" onchange="toggleContentFields()" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                <option value="text">نص</option>
                                <option value="file">ملف</option>
                                <option value="link">رابط</option>
                                <option value="image">صورة</option>
                                <option value="pdf">ملف PDF</option>
                            </select>
                        </div>
                        
                        <!-- Text Content -->
                        <div id="textContent" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">العنوان</label>
                                <input type="text" id="textTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="عنوان المحتوى">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">المحتوى</label>
                                <textarea id="textBody" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" rows="4" placeholder="اكتب المحتوى هنا"></textarea>
                            </div>
                        </div>

                        <!-- File Content -->
                        <div id="fileContent" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">اسم الملف</label>
                                <input type="text" id="fileName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="مثال: جدول الاختبارات.docx">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">رفع الملف</label>
                                <div class="upload-area border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer" onclick="document.getElementById('fileUpload').click()" ondrop="handleFileDrop(event, 'file')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                    <input type="file" id="fileUpload" class="hidden" onchange="handleFileUpload(event, 'file')">
                                    <div class="text-4xl mb-2">📎</div>
                                    <button type="button" class="text-blue-600 hover:text-blue-800 font-medium">
                                        انقر لاختيار ملف أو اسحبه هنا
                                    </button>
                                    <p class="text-sm text-gray-500 mt-2">يدعم: Word, Excel, PowerPoint, ZIP, etc.</p>
                                    <p class="text-xs text-gray-400 mt-1">الحد الأقصى: 10MB</p>
                                    <div id="fileInfo" class="mt-3 text-sm text-green-600 hidden"></div>
                                    <div id="fileProgress" class="mt-2 hidden">
                                        <div class="bg-gray-200 rounded-full h-2">
                                            <div id="fileProgressBar" class="bg-green-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
                                        </div>
                                        <p id="fileProgressText" class="text-xs text-gray-600 mt-1">0%</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">وصف الملف</label>
                                <input type="text" id="fileDescription" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="وصف مختصر للملف">
                            </div>
                        </div>

                        <!-- Image Content -->
                        <div id="imageContent" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">عنوان الصورة</label>
                                <input type="text" id="imageTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="مثال: صورة الفعالية المدرسية">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">رفع الصورة</label>
                                <div class="upload-area border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer" onclick="document.getElementById('imageUpload').click()" ondrop="handleFileDrop(event, 'image')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                    <input type="file" id="imageUpload" class="hidden" accept="image/*" onchange="handleFileUpload(event, 'image')">
                                    <div class="text-4xl mb-2">🖼️</div>
                                    <button type="button" class="text-blue-600 hover:text-blue-800 font-medium">
                                        انقر لاختيار صورة أو اسحبها هنا
                                    </button>
                                    <p class="text-sm text-gray-500 mt-2">يدعم: JPG, PNG, GIF, WebP</p>
                                    <p class="text-xs text-gray-400 mt-1">الحد الأقصى: 5MB</p>
                                    <div id="imagePreview" class="mt-3 hidden">
                                        <img id="imagePreviewImg" class="file-preview mx-auto rounded-lg border">
                                    </div>
                                    <div id="imageInfo" class="mt-2 text-sm text-green-600 hidden"></div>
                                    <div id="imageProgress" class="mt-2 hidden">
                                        <div class="bg-gray-200 rounded-full h-2">
                                            <div id="imageProgressBar" class="bg-green-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
                                        </div>
                                        <p id="imageProgressText" class="text-xs text-gray-600 mt-1">0%</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">وصف الصورة</label>
                                <input type="text" id="imageDescription" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="وصف مختصر للصورة">
                            </div>
                        </div>

                        <!-- PDF Content -->
                        <div id="pdfContent" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">اسم ملف PDF</label>
                                <input type="text" id="pdfTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="مثال: دليل ولي الأمر">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">رفع ملف PDF</label>
                                <div class="upload-area border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer" onclick="document.getElementById('pdfUpload').click()" ondrop="handleFileDrop(event, 'pdf')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                    <input type="file" id="pdfUpload" class="hidden" accept=".pdf" onchange="handleFileUpload(event, 'pdf')">
                                    <div class="text-4xl mb-2">📄</div>
                                    <button type="button" class="text-blue-600 hover:text-blue-800 font-medium">
                                        انقر لاختيار ملف PDF أو اسحبه هنا
                                    </button>
                                    <p class="text-sm text-gray-500 mt-2">يدعم: ملفات PDF فقط</p>
                                    <p class="text-xs text-gray-400 mt-1">الحد الأقصى: 20MB</p>
                                    <div id="pdfInfo" class="mt-3 text-sm text-green-600 hidden"></div>
                                    <div id="pdfProgress" class="mt-2 hidden">
                                        <div class="bg-gray-200 rounded-full h-2">
                                            <div id="pdfProgressBar" class="bg-green-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
                                        </div>
                                        <p id="pdfProgressText" class="text-xs text-gray-600 mt-1">0%</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">وصف ملف PDF</label>
                                <input type="text" id="pdfDescription" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="وصف مختصر لملف PDF">
                            </div>
                        </div>

                        <!-- Link Content -->
                        <div id="linkContent" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">عنوان الرابط</label>
                                <input type="text" id="linkTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="مثال: موقع وزارة التعليم">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">الرابط</label>
                                <input type="url" id="linkUrl" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="https://example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">وصف الرابط</label>
                                <input type="text" id="linkDescription" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="وصف مختصر للرابط">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t flex justify-end space-x-3 space-x-reverse">
                    <button onclick="hideAddContentModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">إلغاء</button>
                    <button onclick="addContent()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">إضافة المحتوى</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // بيانات الدخول
        const ADMIN_CREDENTIALS = {
            username: "admin",
            password: "123456"
        };

        // 🔥 التعديل الوحيد: تغيير رابط API
        const API_BASE = '/api';

        // حالة التطبيق
        let currentService = null;
        let currentSection = null;
        let services = {};

        // تهيئة البيانات الافتراضية
        function initializeDefaultServices() {
            services = {
                schedule: { name: 'الجدول الدراسي', sections: [] },
                homework: { name: 'الواجبات', sections: [] },
                ai: { name: 'ربوت الذكاء الاصطناعي', sections: [] },
                broadcast: { name: 'البروكاست', sections: [] },
                programs: { name: 'البرامج والمسابقات', sections: [] },
                files: { name: 'الملفات المرسلة', sections: [] },
                exams: { name: 'الاختبارات', sections: [] },
                contact: { name: 'تواصل معنا', sections: [] }
            };
        }

        // دوال التواصل مع الخادم
        async function saveChanges() {
            try {
                const response = await fetch(`${API_BASE}/data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ services })
                });

                const result = await response.json();
                
                if (result.success) {
                    showNotification('✅ تم حفظ البيانات في الخادم بنجاح!', 'success');
                } else {
                    showNotification('❌ فشل في حفظ البيانات', 'error');
                }
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('❌ خطأ في الاتصال بالخادم', 'error');
            }
        }

        async function loadDataFromServer() {
            try {
                const response = await fetch(`${API_BASE}/data`);
                const data = await response.json();
                
                if (data.services && Object.keys(data.services).length > 0) {
                    services = data.services;
                    showNotification('✅ تم تحميل البيانات من الخادم', 'success');
                } else {
                    initializeDefaultServices();
                    showNotification('⚠️ لا توجد بيانات في الخادم، سيتم استخدام البيانات الافتراضية', 'info');
                }
                
                // إعادة تحميل المحتوى إذا كان هناك خدمة محددة
                if (currentService) {
                    loadServiceContent(currentService);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                initializeDefaultServices();
                showNotification('❌ فشل في تحميل البيانات من الخادم، سيتم استخدام البيانات الافتراضية', 'error');
            }
        }

        async function uploadFile(file, type) {
            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error uploading file:', error);
                return { success: false, error: 'فشل في رفع الملف' };
            }
        }

        // دوال الإشعارات
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2 space-x-reverse">
                    <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</span>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // إدارة الخدمات
        function selectService(serviceId, element) {
            // التحقق من وجود الخدمة
            if (!services[serviceId]) {
                showNotification('❌ الخدمة غير موجودة', 'error');
                return;
            }

            currentService = serviceId;
            
            // إزالة التفعيل من جميع الأزرار
            document.querySelectorAll('.service-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-100', 'text-blue-800', 'border-blue-300');
            });
            
            // تفعيل الزر المختار
            element.classList.add('active', 'bg-blue-100', 'text-blue-800', 'border-blue-300');
            
            // تحديث العناوين
            document.getElementById('serviceTitle').textContent = services[serviceId].name;
            document.getElementById('serviceDescription').textContent = `إدارة محتوى ${services[serviceId].name}`;
            document.getElementById('addSectionBtn').classList.remove('hidden');
            
            // تحميل محتوى الخدمة
            loadServiceContent(serviceId);
        }

        function loadServiceContent(serviceId) {
            const content = document.getElementById('serviceContent');
            const service = services[serviceId];
            
            if (!service.sections || service.sections.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📋</div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">لا توجد أقسام</h3>
                        <p class="text-gray-600 mb-4">ابدأ بإضافة قسم جديد لهذه الخدمة</p>
                        <button onclick="showAddSectionModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                            ➕ إضافة قسم جديد
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="space-y-6">';
            service.sections.forEach((section, index) => {
                html += `
                    <div class="border border-gray-200 rounded-lg">
                        <div class="bg-gray-50 px-4 py-3 border-b flex justify-between items-center">
                            <div>
                                <h3 class="font-medium text-gray-900">${section.name}</h3>
                                <p class="text-sm text-gray-600">${section.description}</p>
                            </div>
                            <div class="flex space-x-2 space-x-reverse">
                                <button onclick="addContentToSection(${index})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    ➕ إضافة محتوى
                                </button>
                                <button onclick="deleteSection(${index})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    🗑️ حذف
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            ${renderSectionContent(section)}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            content.innerHTML = html;
        }

        function renderSectionContent(section) {
            if (!section.content || section.content.length === 0) {
                return '<p class="text-gray-500 text-center py-4">لا يوجد محتوى في هذا القسم</p>';
            }
            
            let html = '<div class="space-y-3">';
            section.content.forEach((item, index) => {
                if (item.type === 'text') {
                    html += `
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h4 class="font-medium text-blue-900">${item.title}</h4>
                                    <p class="text-blue-800 mt-1 whitespace-pre-line">${item.content}</p>
                                </div>
                                <button onclick="deleteContent('${section.id}', ${index})" class="text-red-600 hover:text-red-800 text-sm">🗑️</button>
                            </div>
                        </div>
                    `;
                } else if (item.type === 'file') {
                    html += `
                        <div class="bg-green-50 p-3 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <span class="text-green-600">📎</span>
                                        <h4 class="font-medium text-green-900">${item.name}</h4>
                                    </div>
                                    <p class="text-green-800 text-sm mt-1">${item.description}</p>
                                    <p class="text-green-600 text-xs mt-1">حجم الملف: ${item.size || 'غير محدد'}</p>
                                    ${item.fileUrl ? `<a href="${item.fileUrl}" target="_blank" class="text-green-600 text-xs mt-1 hover:underline">رابط التحميل</a>` : ''}
                                </div>
                                <button onclick="deleteContent('${section.id}', ${index})" class="text-red-600 hover:text-red-800 text-sm">🗑️</button>
                            </div>
                        </div>
                    `;
                } else if (item.type === 'image') {
                    html += `
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 space-x-reverse mb-2">
                                        <span class="text-yellow-600">🖼️</span>
                                        <h4 class="font-medium text-yellow-900">${item.title}</h4>
                                    </div>
                                    ${item.fileUrl ? `
                                        <img src="${item.fileUrl}" alt="${item.description}" class="file-preview rounded-lg border mb-2">
                                    ` : ''}
                                    <p class="text-yellow-800 text-sm mt-1">${item.description}</p>
                                    <p class="text-yellow-600 text-xs mt-1">${item.size ? `حجم الصورة: ${item.size}` : ''}</p>
                                </div>
                                <button onclick="deleteContent('${section.id}', ${index})" class="text-red-600 hover:text-red-800 text-sm">🗑️</button>
                            </div>
                        </div>
                    `;
                } else if (item.type === 'pdf') {
                    html += `
                        <div class="bg-red-50 p-3 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <span class="text-red-600">📄</span>
                                        <h4 class="font-medium text-red-900">${item.title}</h4>
                                    </div>
                                    <p class="text-red-800 text-sm mt-1">${item.description}</p>
                                    <p class="text-red-600 text-xs mt-1">حجم الملف: ${item.size || 'غير محدد'}</p>
                                    ${item.fileUrl ? `<a href="${item.fileUrl}" target="_blank" class="text-red-600 text-xs mt-1 hover:underline">فتح ملف PDF</a>` : ''}
                                </div>
                                <button onclick="deleteContent('${section.id}', ${index})" class="text-red-600 hover:text-red-800 text-sm">🗑️</button>
                            </div>
                        </div>
                    `;
                } else if (item.type === 'link') {
                    html += `
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <span class="text-purple-600">🔗</span>
                                        <h4 class="font-medium text-purple-900">${item.title}</h4>
                                    </div>
                                    <p class="text-purple-800 text-sm mt-1">${item.description}</p>
                                    <a href="${item.url}" target="_blank" class="text-purple-600 text-xs mt-1 hover:underline">${item.url}</a>
                                </div>
                                <button onclick="deleteContent('${section.id}', ${index})" class="text-red-600 hover:text-red-800 text-sm">🗑️</button>
                            </div>
                        </div>
                    `;
                }
            });
            html += '</div>';
            
            return html;
        }

        // إدارة الأقسام
        function showAddSectionModal() {
            document.getElementById('addSectionModal').classList.remove('hidden');
            document.getElementById('addSectionModal').classList.add('flex');
        }

        function hideAddSectionModal() {
            document.getElementById('addSectionModal').classList.add('hidden');
            document.getElementById('addSectionModal').classList.remove('flex');
            document.getElementById('sectionName').value = '';
            document.getElementById('sectionDescription').value = '';
            document.getElementById('sectionType').value = 'text';
        }

        function addSection() {
            const name = document.getElementById('sectionName').value.trim();
            const description = document.getElementById('sectionDescription').value.trim();
            const type = document.getElementById('sectionType').value;
            
            if (!name) {
                alert('يرجى إدخال اسم القسم');
                return;
            }
            
            const section = {
                id: Date.now().toString(),
                name: name,
                description: description || 'لا يوجد وصف',
                type: type,
                content: []
            };
            
            services[currentService].sections.push(section);
            hideAddSectionModal();
            loadServiceContent(currentService);
            saveChanges();
        }

        function deleteSection(index) {
            if (confirm('هل أنت متأكد من حذف هذا القسم؟')) {
                services[currentService].sections.splice(index, 1);
                loadServiceContent(currentService);
                saveChanges();
            }
        }

        // إدارة المحتوى
        function addContentToSection(sectionIndex) {
            currentSection = sectionIndex;
            document.getElementById('addContentModal').classList.remove('hidden');
            document.getElementById('addContentModal').classList.add('flex');
        }

        function hideAddContentModal() {
            document.getElementById('addContentModal').classList.add('hidden');
            document.getElementById('addContentModal').classList.remove('flex');
            document.getElementById('textTitle').value = '';
            document.getElementById('textBody').value = '';
            document.getElementById('fileName').value = '';
            document.getElementById('fileDescription').value = '';
            document.getElementById('imageTitle').value = '';
            document.getElementById('imageDescription').value = '';
            document.getElementById('pdfTitle').value = '';
            document.getElementById('pdfDescription').value = '';
            document.getElementById('linkTitle').value = '';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkDescription').value = '';
            document.getElementById('contentType').value = 'text';
            
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('fileProgress').classList.add('hidden');
            document.getElementById('imageProgress').classList.add('hidden');
            document.getElementById('pdfProgress').classList.add('hidden');
            
            toggleContentFields();
        }

        function toggleContentFields() {
            const type = document.getElementById('contentType').value;
            
            // إخفاء جميع الحقول أولاً
            const contentTypes = ['text', 'file', 'image', 'pdf', 'link'];
            contentTypes.forEach(contentType => {
                const element = document.getElementById(contentType + 'Content');
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            // إظهار الحقول المطلوبة فقط
            const targetElement = document.getElementById(type + 'Content');
            if (targetElement) {
                targetElement.classList.remove('hidden');
            }
        }

        // إدارة الملفات
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
        }

        function handleFileDrop(event, type) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0], type);
            }
        }

        function handleFileSelect(file, type) {
            const inputId = type + 'Upload';
            const inputElement = document.getElementById(inputId);
            
            if (inputElement) {
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                inputElement.files = dataTransfer.files;
                
                const changeEvent = new Event('change', { bubbles: true });
                inputElement.dispatchEvent(changeEvent);
            }
        }

        async function handleFileUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
            
            // التحقق من حجم الملف
            if (type === 'image' && fileSizeMB > 5) {
                alert('❌ حجم الصورة كبير جداً! الحد الأقصى 5MB');
                return;
            }
            if (type === 'pdf' && fileSizeMB > 20) {
                alert('❌ حجم ملف PDF كبير جداً! الحد الأقصى 20MB');
                return;
            }
            if (type === 'file' && fileSizeMB > 10) {
                alert('❌ حجم الملف كبير جداً! الحد الأقصى 10MB');
                return;
            }
            
            // محاكاة عملية الرفع
            simulateUpload(file, type);
            
            // رفع الملف الحقيقي للخادم
            const uploadResult = await uploadFile(file, type);
            
            if (uploadResult.success) {
                const infoElement = document.getElementById(`${type}Info`);
                if (infoElement) {
                    infoElement.innerHTML = `✅ تم رفع: <strong>${file.name}</strong> (${fileSizeMB} MB)`;
                    infoElement.classList.remove('hidden');
                }
                
                // حفظ رابط الملف
                const uploadInput = document.getElementById(`${type}Upload`);
                if (uploadInput) {
                    uploadInput.setAttribute('data-file-url', uploadResult.url);
                }
            }
            
            // معاينة الصورة
            if (type === 'image') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImg = document.getElementById('imagePreviewImg');
                    const previewContainer = document.getElementById('imagePreview');
                    if (previewImg && previewContainer) {
                        previewImg.src = e.target.result;
                        previewContainer.classList.remove('hidden');
                    }
                };
                reader.readAsDataURL(file);
                
                // تعبئة العنوان تلقائياً إذا كان الحقل موجوداً وفارغاً
                const imageTitleInput = document.getElementById('imageTitle');
                if (imageTitleInput && !imageTitleInput.value.trim()) {
                    imageTitleInput.value = file.name.replace(/\.[^/.]+$/, "");
                }
            } else {
                // تعبئة العنوان تلقائياً لأنواع الملفات الأخرى
                const titleInput = document.getElementById(`${type}Title`);
                if (titleInput && !titleInput.value.trim()) {
                    titleInput.value = file.name.replace(/\.[^/.]+$/, "");
                }
            }
        }

        function simulateUpload(file, type) {
            const progressBar = document.getElementById(type + 'ProgressBar');
            const progressText = document.getElementById(type + 'ProgressText');
            const progressContainer = document.getElementById(type + 'Progress');
            const infoElement = document.getElementById(type + 'Info');
            
            if (progressContainer) progressContainer.classList.remove('hidden');
            if (infoElement) {
                infoElement.classList.remove('hidden');
                infoElement.textContent = `جاري رفع: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            }
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                
                if (progressBar) progressBar.style.width = progress + '%';
                if (progressText) progressText.textContent = Math.round(progress) + '%';
            }, 200);
        }

        function addContent() {
            const type = document.getElementById('contentType').value;
            let content = {};
            
            if (type === 'text') {
                const title = document.getElementById('textTitle').value.trim();
                const body = document.getElementById('textBody').value.trim();
                
                if (!title || !body) {
                    alert('يرجى إدخال العنوان والمحتوى');
                    return;
                }
                
                content = {
                    type: 'text',
                    title: title,
                    content: body
                };
            } else if (type === 'file') {
                const name = document.getElementById('fileName').value.trim();
                const description = document.getElementById('fileDescription').value.trim();
                const fileInput = document.getElementById('fileUpload');
                const file = fileInput.files[0];
                
                if (!name) {
                    alert('يرجى إدخال اسم الملف');
                    return;
                }
                
                content = {
                    type: 'file',
                    name: name,
                    description: description || 'لا يوجد وصف',
                    size: file ? (file.size / 1024 / 1024).toFixed(2) + ' MB' : 'غير محدد',
                    fileUrl: fileInput ? fileInput.getAttribute('data-file-url') || null : null
                };
            } else if (type === 'image') {
                const title = document.getElementById('imageTitle').value.trim();
                const description = document.getElementById('imageDescription').value.trim();
                const imageInput = document.getElementById('imageUpload');
                const imageFile = imageInput.files[0];
                
                if (!title) {
                    alert('يرجى إدخال عنوان الصورة');
                    return;
                }
                
                content = {
                    type: 'image',
                    title: title,
                    description: description || 'لا يوجد وصف',
                    size: imageFile ? (imageFile.size / 1024 / 1024).toFixed(2) + ' MB' : 'غير محدد',
                    fileUrl: imageInput ? imageInput.getAttribute('data-file-url') || null : null
                };
            } else if (type === 'pdf') {
                const title = document.getElementById('pdfTitle').value.trim();
                const description = document.getElementById('pdfDescription').value.trim();
                const pdfInput = document.getElementById('pdfUpload');
                const pdfFile = pdfInput.files[0];
                
                if (!title) {
                    alert('يرجى إدخال اسم ملف PDF');
                    return;
                }
                
                content = {
                    type: 'pdf',
                    title: title,
                    description: description || 'لا يوجد وصف',
                    size: pdfFile ? (pdfFile.size / 1024 / 1024).toFixed(2) + ' MB' : 'غير محدد',
                    fileUrl: pdfInput ? pdfInput.getAttribute('data-file-url') || null : null
                };
            } else if (type === 'link') {
                const title = document.getElementById('linkTitle').value.trim();
                const url = document.getElementById('linkUrl').value.trim();
                const description = document.getElementById('linkDescription').value.trim();
                
                if (!title || !url) {
                    alert('يرجى إدخال عنوان الرابط والرابط');
                    return;
                }
                
                content = {
                    type: 'link',
                    title: title,
                    url: url,
                    description: description || 'لا يوجد وصف'
                };
            }
            
            services[currentService].sections[currentSection].content.push(content);
            hideAddContentModal();
            loadServiceContent(currentService);
            saveChanges();
        }

        function deleteContent(sectionId, contentIndex) {
            if (confirm('هل أنت متأكد من حذف هذا المحتوى؟')) {
                const sectionIndex = services[currentService].sections.findIndex(s => s.id === sectionId);
                if (sectionIndex !== -1) {
                    services[currentService].sections[sectionIndex].content.splice(contentIndex, 1);
                    loadServiceContent(currentService);
                    saveChanges();
                }
            }
        }

        // إدارة المصادقة
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            const username = localStorage.getItem('adminUsername');
            
            if (isLoggedIn === 'true' && username) {
                showDashboard(username);
            }
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('adminUsername', username);
                if (rememberMe) {
                    localStorage.setItem('rememberMe', 'true');
                }
                
                showDashboard(username);
                loadDataFromServer();
            } else {
                alert('❌ اسم المستخدم أو كلمة المرور غير صحيحة');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        });

        function showDashboard(username) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('adminName').textContent = `مرحباً، ${username}`;
        }

        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminUsername');
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('loginForm').reset();
            }
        }

        // التهيئة
        document.addEventListener('DOMContentLoaded', function() {
            // إضافة مستمعات الأحداث للأزرار
            document.querySelectorAll('.service-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const serviceId = this.getAttribute('data-service');
                    selectService(serviceId, this);
                });
            });

            // التحقق من المصادقة
            checkAuth();
            
            // تهيئة البيانات الافتراضية
            initializeDefaultServices();
        });
    </script>
</body>
</html>